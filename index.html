<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
            <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="apple-mobile-web-app-title" content="HouseMath.app">
        <meta name="theme-color" content="#1e40af">
        <meta name="description" content="Professional real estate calculator suite with mortgage, investment, cash flow, and closing cost calculators. Built for real estate professionals.">
        <meta name="keywords" content="real estate calculator, mortgage calculator, investment property, cash flow, closing costs, commission calculator">
        <meta name="author" content="HouseMath.app">
        <meta name="robots" content="index, follow">
        <meta http-equiv="X-Content-Type-Options" content="nosniff">
        <meta http-equiv="X-Frame-Options" content="DENY">
        <meta http-equiv="X-XSS-Protection" content="1; mode=block">
        <meta name="referrer" content="strict-origin-when-cross-origin">
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://housemath.app/">
        <meta property="og:title" content="HouseMath.app - Professional Real Estate Calculator Suite">
        <meta property="og:description" content="Free professional real estate calculators for mortgage payments, investment analysis, cash flow, closing costs, and commission calculations. Built for real estate agents, investors, and professionals.">
        <meta property="og:image" content="https://housemath.app/og-image.jpg">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="HouseMath.app">
        <meta property="og:locale" content="en_US">
        
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://housemath.app/">
        <meta property="twitter:title" content="HouseMath.app - Professional Real Estate Calculator Suite">
        <meta property="twitter:description" content="Free professional real estate calculators for mortgage payments, investment analysis, cash flow, closing costs, and commission calculations.">
        <meta property="twitter:image" content="https://housemath.app/og-image.jpg">
        <meta property="twitter:creator" content="@HouseMathApp">
        
        <!-- Additional SEO -->
        <meta name="language" content="English">
        <meta name="geo.region" content="US">
        <meta name="geo.placename" content="United States">
        <link rel="canonical" href="https://housemath.app/">
        <link rel="sitemap" type="application/xml" href="/sitemap.xml">
        
        <title>HouseMath.app - Free Real Estate Calculator Suite | Mortgage, Investment & Cash Flow Tools</title>
        
            <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='15' fill='%231e40af'/><text x='50' y='65' font-family='Arial' font-size='60' fill='white' text-anchor='middle'>üè†</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;HouseMath.app&quot;,&quot;short_name&quot;:&quot;HouseMath&quot;,&quot;description&quot;:&quot;Professional Real Estate Calculator Suite&quot;,&quot;start_url&quot;:&quot;/&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%23f8fafc&quot;,&quot;theme_color&quot;:&quot;%231e40af&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' rx='20' fill='%231e40af'/><path d='M96 40 L140 70 L140 150 L52 150 L52 70 Z' fill='white'/><path d='M96 40 L155 80 L37 80 Z' fill='white'/><rect x='88' y='125' width='16' height='25' fill='%231e40af'/><rect x='70' y='100' width='12' height='12' fill='%231e40af'/><rect x='110' y='100' width='12' height='12' fill='%231e40af'/></svg>&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}]}"
        
        <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js" as="script">
    <!-- Chart.js for visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <!-- PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- HTML2Canvas for image export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
            <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
        <!-- Preload critical resources -->
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" as="script">
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" as="script">
    
    <!-- Enhanced Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": ["WebApplication", "SoftwareApplication"],
        "name": "HouseMath.app",
        "alternateName": "House Math Calculator Suite",
        "description": "Free professional real estate calculator suite including mortgage payment calculator, investment property analyzer, rental cash flow calculator, closing cost estimator, buyer cost sheet, commission calculator, and property comparison tool. Built specifically for real estate agents, investors, and property professionals.",
        "url": "https://housemath.app",
        "sameAs": [
            "https://twitter.com/HouseMathApp"
        ],
        "applicationCategory": ["BusinessApplication", "FinanceApplication"],
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "softwareVersion": "1.0",
        "datePublished": "2024-01-01",
        "dateModified": "2024-01-01",
        "inLanguage": "en-US",
        "isAccessibleForFree": true,
        "license": "https://housemath.app/terms",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock",
            "validFrom": "2024-01-01"
        },
        "creator": {
            "@type": "Organization",
            "name": "HouseMath.app",
            "url": "https://housemath.app",
            "logo": "https://housemath.app/logo.png"
        },
        "featureList": [
            "Mortgage Payment Calculator",
            "Investment Property Analysis",
            "Rental Cash Flow Calculator", 
            "Closing Costs Calculator",
            "Buyer Cost Sheet",
            "Real Estate Commission Calculator",
            "Property Comparison Tool",
            "PDF Export Functionality",
            "Mobile Responsive Design",
            "Offline PWA Capability"
        ],
        "screenshot": "https://housemath.app/screenshot.jpg",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "150",
            "bestRating": "5",
            "worstRating": "1"
        },
        "audience": {
            "@type": "Audience",
            "audienceType": "Real Estate Professionals, Property Investors, Home Buyers, Real Estate Agents"
        }
    }
    </script>
    
    <!-- FAQ Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How accurate are the mortgage calculations?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Our mortgage calculator uses standard industry formulas and provides highly accurate estimates. However, actual rates and terms may vary based on your lender, credit score, and specific loan program."
                }
            },
            {
                "@type": "Question", 
                "name": "Can I use this for investment property analysis?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes! HouseMath.app includes specialized tools for investment property analysis including cash flow calculations, ROI analysis, and long-term investment projections."
                }
            },
            {
                "@type": "Question",
                "name": "Is HouseMath.app free to use?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes, HouseMath.app is completely free to use. All calculators and features are available at no cost to help real estate professionals and investors make informed decisions."
                }
            }
        ]
    }
    </script>
    
    <style>
        :root {
            --primary-color: #1e40af;
            --secondary-color: #3b82f6;
            --accent-color: #60a5fa;
            --text-color: #1e293b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
        }
        
        .dark {
            --primary-color: #3b82f6;
            --secondary-color: #60a5fa;
            --accent-color: #93c5fd;
            --text-color: #f1f5f9;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --border-color: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        nav {
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .mobile-menu-button {
            display: none;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-height: 48px;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
        }
        
        .mobile-menu-button:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(30, 64, 175, 0.4);
        }
        
        .mobile-menu-button i {
            font-size: 18px;
        }
        
        /* Mobile Menu Overlay */
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .mobile-menu-overlay.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .mobile-menu-content {
            background: var(--card-bg);
            border-radius: 12px;
            max-width: 400px;
            width: 100%;
            max-height: calc(100vh - 40px);
            margin-top: 10vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: slideInMobile 0.3s ease;
        }
        
        @media (max-height: 600px) {
            .mobile-menu-content {
                margin-top: 20px;
                max-height: calc(100vh - 40px);
            }
        }
        
        @keyframes slideInMobile {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .mobile-menu-header h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .mobile-menu-close {
            background: #ef4444;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }
        
        .mobile-menu-close:hover {
            background: #dc2626;
            transform: scale(1.1);
        }
        
        .mobile-menu-items {
            padding: 20px 0;
        }
        
        .mobile-tab {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            min-height: 56px;
        }
        
        .mobile-tab:hover {
            background: rgba(30, 64, 175, 0.1);
            border-left-color: var(--primary-color);
        }
        
        .mobile-tab.active {
            background: rgba(30, 64, 175, 0.15);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .mobile-tab i {
            font-size: 20px;
            width: 24px;
            text-align: center;
            color: var(--primary-color);
        }
        
        .mobile-tab span {
            font-size: 16px;
            font-weight: 500;
        }
        
        .mobile-menu-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        @media (max-width: 768px) {
            .mobile-menu-button {
                display: flex;
            }

            .tabs {
                display: none;
            }

            nav {
                padding: 15px;
            }
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .logo i {
            align-items: center;
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toggle-wrapper {
            position: relative;
            width: 48px;
            height: 24px;
            background-color: #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
        }
        
        .toggle-dot {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .dark .toggle-dot {
            transform: translateX(24px);
        }
        
        .dark .toggle-wrapper {
            background-color: #4b5563;
        }
        
        /* Dropdown styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--card-bg);
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            border-radius: 6px;
            z-index: 10;
            border: 1px solid var(--border-color);
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .dropdown-content a {
            color: var(--text-color);
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }
        
        .dropdown-content a:hover {
            background-color: var(--bg-color);
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            font-size: 16px; /* Prevents zoom on iOS */
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px; /* Apple's minimum touch target */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            box-shadow: 0 4px 16px rgba(30, 64, 175, 0.4);
            transform: translateY(-1px);
        }
        
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(30, 64, 175, 0.3);
        }
        

        
        .btn-red {
            background-color: #ef4444;
            color: white;
        }
        
        .btn-red:hover {
            background-color: #dc2626;
        }
        
        .btn-green {
            background-color: #10b981;
            color: white;
        }
        
        .btn-green:hover {
            background-color: #059669;
        }




        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-top: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        
        .tabs::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }
        
        .tab {
            padding: 16px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-height: 44px; /* Apple's minimum touch target */
            display: flex;
            align-items: center;
            font-weight: 500;
            background: transparent;
            border-top: none;
            border-left: none;
            border-right: none;
            border-radius: 0;
            box-shadow: none;
            position: relative;
        }
        
        .tab:hover {
            background-color: rgba(30, 64, 175, 0.1);
            color: var(--primary-color);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            background-color: rgba(30, 64, 175, 0.1);
        }
        
        .tab:active {
            transform: none; /* Override button active transform */
        }
        
        .calculator {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }
        
        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-color) 0%, #1e3a8a 100%);
            position: relative;
            overflow-x: hidden;
            animation: pageEnter 1s ease-out;
        }

        @keyframes pageEnter {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .landing-hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 40px 20px;
            text-align: center;
            background: radial-gradient(ellipse at top, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
        }

        .hero-content {
            max-width: 800px;
            position: relative;
            z-index: 2;
        }

        .hero-animation {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
        }

        .floating-icon {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: float 3s ease-in-out infinite;
        }

        .floating-icon:nth-child(1) {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .floating-icon:nth-child(2) {
            top: 60px;
            left: 20px;
        }

        .floating-icon:nth-child(3) {
            top: 60px;
            right: 20px;
        }

        .floating-icon i {
            font-size: 24px;
            color: var(--primary-color);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(-20px) rotate(0deg); }
            75% { transform: translateY(-10px) rotate(-5deg); }
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 120px 0 20px 0;
            color: var(--text-color);
            line-height: 1.1;
            animation: slideInUp 0.8s ease-out 0.3s both;
        }

        .brand-gradient {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 500;
            animation: slideInUp 0.8s ease-out 0.5s both;
        }

        .hero-description {
            font-size: 1.125rem;
            color: var(--text-color);
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            animation: slideInUp 0.8s ease-out 0.7s both;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 50px;
            flex-wrap: wrap;
            animation: scaleIn 0.8s ease-out 0.9s both;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-color);
            opacity: 0.8;
            margin-top: 5px;
        }

        .hero-cta {
            margin-bottom: 60px;
            animation: slideInUp 0.8s ease-out 1.1s both;
        }

        .cta-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.125rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .cta-button:hover::before {
            left: 100%;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);
        }

        .cta-button i {
            margin-right: 10px;
        }

        .cta-button-large {
            font-size: 1.25rem;
            padding: 20px 50px;
        }

        .cta-note {
            margin-top: 15px;
            font-size: 0.875rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .landing-features {
            padding: 80px 20px;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
        }

        .features-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .features-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 60px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out both;
        }

        .feature-card:nth-child(1) { animation-delay: 1.3s; }
        .feature-card:nth-child(2) { animation-delay: 1.4s; }
        .feature-card:nth-child(3) { animation-delay: 1.5s; }
        .feature-card:nth-child(4) { animation-delay: 1.6s; }
        .feature-card:nth-child(5) { animation-delay: 1.7s; }
        .feature-card:nth-child(6) { animation-delay: 1.8s; }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover::before {
            opacity: 1;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            position: relative;
            z-index: 1;
        }

        .feature-icon i {
            font-size: 32px;
            color: white;
        }

        .feature-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .feature-card p {
            color: var(--text-color);
            opacity: 0.8;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .feature-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            z-index: 2;
        }

        .landing-benefits {
            padding: 80px 20px;
            background: var(--bg-color);
        }

        .benefits-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
        }

        .benefits-content h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 40px;
        }

        .benefits-list {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .benefit-item {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .benefit-icon {
            width: 60px;
            height: 60px;
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .benefit-icon i {
            font-size: 24px;
            color: var(--primary-color);
        }

        .benefit-text h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .benefit-text p {
            color: var(--text-color);
            opacity: 0.8;
            line-height: 1.5;
        }

        .benefits-visual {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .calculator-preview {
            position: relative;
            transform: rotate(-5deg);
            transition: transform 0.3s ease;
        }

        .calculator-preview:hover {
            transform: rotate(0deg) scale(1.05);
        }

        .preview-screen {
            width: 300px;
            height: 200px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .preview-header {
            height: 30px;
            background: var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 15px;
        }

        .preview-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-color);
            opacity: 0.6;
        }

        .preview-content {
            padding: 20px;
        }

        .preview-chart {
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.1));
            border-radius: 6px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .preview-chart::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-color);
            transform: translateY(-50%);
            animation: chartLine 2s ease-in-out infinite;
        }

        @keyframes chartLine {
            0%, 100% { transform: translateY(-50%) scaleX(0.5); }
            50% { transform: translateY(-50%) scaleX(1); }
        }

        .preview-stats {
            display: flex;
            gap: 10px;
        }

        .preview-stat {
            flex: 1;
            height: 40px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        .preview-stat:nth-child(2) {
            animation-delay: 0.3s;
        }

        .landing-cta-final {
            padding: 80px 20px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(30, 64, 175, 0.1));
            text-align: center;
        }

        .final-cta-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .final-cta-content h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 20px;
        }

        .final-cta-content p {
            font-size: 1.125rem;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }

            .hero-stats {
                gap: 20px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .feature-card {
                padding: 20px;
            }

            .benefits-container {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .benefits-content h2 {
                font-size: 2rem;
                text-align: center;
            }

            .calculator-preview {
                transform: none;
            }

            .calculator-preview:hover {
                transform: scale(1.02);
            }

            .calculator {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .container {
                padding: 0 10px;
            }

            nav {
                padding: 10px 15px;
            }

            .logo {
                font-size: 1.25rem;
            }



            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .chart-container {
                height: 250px;
            }

            .export-actions {
                flex-direction: column;
                gap: 8px !important;
            }

            .export-actions .dropdown,
            .export-actions button {
                width: 100%;
            }

            .card {
                padding: 15px;
                margin-bottom: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 2px;
            }

            .tab {
                min-width: fit-content;
                padding: 10px 15px;
                font-size: 0.875rem;
            }

            .details-table {
                font-size: 0.875rem;
            }

            .stat-box {
                padding: 12px;
            }

            .stat-value {
                font-size: 1.5rem;
            }


        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        input[type="number"], select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            font-size: 16px; /* Prevents zoom on iOS */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* Improved number input for mobile */
        input[type="number"] {
            -webkit-appearance: none;
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex-grow: 1;
            -webkit-appearance: none;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        input[type="range"]:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .slider-value {
            min-width: 40px;
            text-align: right;
            font-weight: 500;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background-color: rgba(59, 130, 246, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .dark .stat-box {
            background-color: rgba(59, 130, 246, 0.2);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .dark .stat-label {
            color: #9ca3af;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 5px;
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            margin-bottom: 25px;
        }
        
        .details-table {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .details-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .details-label {
            font-size: 0.875rem;
        }
        
        .details-value {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
        
        .report-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .report-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
        }
        
        .bg-blue-light {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .dark .bg-blue-light {
            background-color: rgba(59, 130, 246, 0.2);
        }
        
        .bg-green-light {
            background-color: rgba(16, 185, 129, 0.1);
        }
        
        .dark .bg-green-light {
            background-color: rgba(16, 185, 129, 0.2);
        }
        
        .report-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .report-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .report-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .report-charts {
                grid-template-columns: 1fr;
            }
        }
        
        .report-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .dark .report-footer {
            color: #9ca3af;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-color);
            color: var(--bg-color);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .closing-cost-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .closing-cost-item .label {
            flex: 1;
        }
        
        .closing-cost-item .amount {
            margin: 0 15px;
            font-weight: 500;
        }
        
        .closing-cost-item .split {
            display: flex;
            gap: 10px;
        }
        
        .split-option {
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .split-option.active {
            background-color: var(--primary-color);
            color: white;
        }

        .expense-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .expense-section h3 {
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .expense-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                align-items: flex-start;
            }

            .actions {
                flex-direction: row-reverse;
                align-items: flex-start;
                gap: 10px;
            }

            .tabs {
                display: none;
                flex-direction: column;
                align-items: flex-start;
            }

            .tab {
                width: 100%;
                text-align: left;
                padding: 12px 10px;
            }

            .calculator {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .report-grid {
                grid-template-columns: 1fr;
            }

            .report-charts {
                grid-template-columns: 1fr;
            }

            .details-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .details-label, .details-value {
                width: 100%;
                text-align: left;
            }

            .details-value {
                margin-top: 5px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }

            .card-title {
                font-size: 1rem;
            }

            .form-group label {
                font-size: 0.875rem;
            }

            input[type="number"], select {
                padding: 8px 10px;
            }

            button {
                padding: 2px 6px;
            }

            .btn-primary, .btn-export {
                font-size: 0.875rem;
            }

            .stat-value {
                font-size: 1.25rem;
            }

            .details-label, .details-value {
                font-size: 0.75rem;
            }

            .report-header h1 {
                font-size: 1.5rem;
            }

            .report-header p {
                font-size: 0.75rem;
            }

            .report-section h2 {
                font-size: 1.125rem;
            }

            .report-section h3 {
                font-size: 1rem;
            }

            .report-footer p {
                font-size: 0.75rem;
            }
        }
        /* Additional mobile optimizations for save/load buttons */
        @media (max-width: 768px) {
            .action-text {
                display: none;
            }
            
            .actions {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .actions button {
                padding: 10px 12px;
                margin-right: 8px;
                font-size: 14px;
            }
            
            .nav-content {
                flex-direction: row;
                align-items: center;
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .actions button {
                padding: 10px;
                margin-right: 4px;
                font-size: 16px;
                min-width: 44px;
            }
            
            .actions {
                gap: 6px;
            }
            
            .nav-content {
                gap: 10px;
            }
            
            .mobile-menu-button span {
                display: none;
            }
            
            .mobile-menu-button {
                padding: 12px;
                min-width: 48px;
            }
        }
    </style>
</head>
<body class="dark">
    <!-- Loading Screen -->
    <div id="loading-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
    ">
        <div style="text-align: center; color: white;">
            <!-- Logo Animation -->
            <div style="
                width: 120px;
                height: 120px;
                margin: 0 auto 30px;
                position: relative;
                animation: logoSpin 2s linear infinite;
            ">
                <svg width="120" height="120" viewBox="0 0 120 120" style="filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));">
                    <path d="M60 15 L90 35 L90 85 L30 85 L30 35 Z" fill="rgba(255,255,255,0.95)" stroke="rgba(255,255,255,0.8)" stroke-width="2"/>
                    <path d="M60 15 L100 40 L20 40 Z" fill="rgba(255,255,255,1)" stroke="rgba(255,255,255,0.9)" stroke-width="2"/>
                    <rect x="52" y="65" width="16" height="20" fill="rgba(30,64,175,0.9)" rx="2"/>
                    <rect x="40" y="50" width="12" height="12" fill="rgba(30,64,175,0.7)" rx="1"/>
                    <rect x="68" y="50" width="12" height="12" fill="rgba(30,64,175,0.7)" rx="1"/>
                    <text x="60" y="75" text-anchor="middle" fill="rgba(30,64,175,1)" font-family="Arial, sans-serif" font-size="18" font-weight="bold">HM</text>
                </svg>
            </div>
            
            <!-- App Name -->
            <h1 style="
                font-size: 2.5rem;
                font-weight: 700;
                margin-bottom: 10px;
                letter-spacing: -1px;
                animation: fadeInUp 1s ease 0.5s both;
            ">HouseMath.app</h1>
            
            <!-- Tagline -->
            <p style="
                font-size: 1.1rem;
                opacity: 0.9;
                margin-bottom: 40px;
                animation: fadeInUp 1s ease 0.7s both;
            ">Professional Real Estate Calculator Suite</p>
            
            <!-- Loading Animation -->
            <div style="
                width: 60px;
                height: 60px;
                border: 4px solid rgba(255,255,255,0.3);
                border-top: 4px solid white;
                border-radius: 50%;
                margin: 0 auto;
                animation: spin 1s linear infinite;
            "></div>
            
            <!-- Loading Text -->
            <p style="
                font-size: 0.9rem;
                margin-top: 20px;
                opacity: 0.8;
                animation: pulse 2s infinite;
            ">Loading your financial tools...</p>
        </div>
    </div>

    <!-- Loading Animations -->
    <style>
        @keyframes logoSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }
    </style>

    <!-- Header with Custom Logo -->
    <header role="banner" class="app-header" style="background: var(--primary-color); padding: 15px 0; text-align: center; color: white; box-shadow: 0 2px 10px rgba(30,64,175,0.2); display: none;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
            <!-- Custom HM Logo with House -->
            <div style="position: relative; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                <svg width="50" height="50" viewBox="0 0 50 50" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));" alt="HouseMath.app Logo" role="img" aria-label="House-shaped logo with HM initials">
                    <!-- House shape background -->
                    <path d="M25 8 L40 20 L40 40 L10 40 L10 20 Z" fill="rgba(255,255,255,0.9)" stroke="rgba(255,255,255,0.5)" stroke-width="1"/>
                    <!-- Roof -->
                    <path d="M25 8 L42 21 L8 21 Z" fill="rgba(255,255,255,0.95)" stroke="rgba(255,255,255,0.6)" stroke-width="1"/>
                    <!-- Door -->
                    <rect x="22" y="32" width="6" height="8" fill="rgba(37,99,235,0.8)" rx="1"/>
                    <!-- Windows -->
                    <rect x="15" y="25" width="4" height="4" fill="rgba(37,99,235,0.6)" rx="0.5"/>
                    <rect x="31" y="25" width="4" height="4" fill="rgba(37,99,235,0.6)" rx="0.5"/>
                    <!-- HM Text -->
                    <text x="25" y="35" text-anchor="middle" fill="rgba(37,99,235,1)" font-family="Arial, sans-serif" font-size="12" font-weight="bold">HM</text>
                </svg>
            </div>
            <div>
                <h1 id="app-title" style="margin: 0; font-size: 1.8rem; font-weight: 700; cursor: pointer; user-select: none; letter-spacing: -0.5px;">HouseMath.app</h1>
                <p style="margin: 2px 0 0 0; font-size: 0.85rem; opacity: 0.9; font-weight: 300;">Professional Real Estate Calculator Suite</p>
                <p style="margin: 4px 0 0 0; font-size: 0.75rem; opacity: 0.8; font-weight: 300; max-width: 400px;">Free mortgage calculator, investment analysis, cash flow calculator, closing costs, and commission tools for real estate professionals</p>
            </div>
        </div>
    </header>

    <!-- Navigation bar -->
    <nav role="navigation" aria-label="Main navigation" class="app-navigation" style="display: none;">
        <div class="nav-content">
            <button class="mobile-menu-button" id="mobile-menu-toggle" aria-label="Open calculator menu" aria-expanded="false" aria-controls="mobile-menu-overlay">
                <i class="fas fa-bars"></i>
                <span>Menu</span>
            </button>
            
            <div class="actions">
                <button id="save-calc" title="Save Current Calculation (Ctrl+S)" class="btn-primary">
                    <i class="fas fa-save"></i>
                    <span class="action-text">Save</span>
                </button>
                <button id="load-calc" title="Load Saved Calculation (Ctrl+L)" class="btn-primary">
                    <i class="fas fa-folder-open"></i>
                    <span class="action-text">Load</span>
                </button>

                <div class="theme-toggle">
                    <i class="far fa-sun"></i>
                    <div class="toggle-wrapper" id="theme-toggle">
                        <div class="toggle-dot"></div>
                    </div>
                    <i class="far fa-moon"></i>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobile-menu-overlay">
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <h3>Calculators</h3>
                    <button class="mobile-menu-close" id="mobile-menu-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-items">
                    <div class="mobile-tab active" data-tab="mortgage">
                        <i class="fas fa-home"></i>
                        <span>Mortgage Calculator</span>
                    </div>
                    <div class="mobile-tab" data-tab="investment">
                        <i class="fas fa-chart-line"></i>
                        <span>Investment Property</span>
                    </div>
                    <div class="mobile-tab" data-tab="cashflow">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Rental Cash Flow</span>
                    </div>
                    <div class="mobile-tab" data-tab="closing">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Closing Costs</span>
                    </div>
                    <div class="mobile-tab" data-tab="buyer">
                        <i class="fas fa-user-check"></i>
                        <span>Buyer Cost Sheet</span>
                    </div>
                    <div class="mobile-tab" data-tab="commission">
                        <i class="fas fa-percentage"></i>
                        <span>Commission Calculator</span>
                    </div>
                    <div class="mobile-tab" data-tab="comparison">
                        <i class="fas fa-balance-scale"></i>
                        <span>Property Comparison</span>
                    </div>
                    <div class="mobile-tab" data-tab="report">
                        <i class="fas fa-file-alt"></i>
                        <span>Generated Report</span>
                    </div>
                </div>
                <div class="mobile-menu-footer">
                    <a href="http://www.zebarigroup.com" target="_blank" style="color: #6b7280; text-decoration: none; font-size: 0.875rem;">
                        Powered by Zebari Group IT Services
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Beautiful Landing Page -->
    <div id="landing-page" class="landing-page">
        <div class="landing-hero">
            <div class="hero-content">
                <div class="hero-animation">
                    <div class="floating-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="floating-icon" style="animation-delay: 0.5s;">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="floating-icon" style="animation-delay: 1s;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                
                <h1 class="hero-title">
                    Welcome to <span class="brand-gradient">HouseMath.app</span>
                </h1>
                
                <p class="hero-subtitle">
                    Professional Real Estate Calculator Suite
                </p>
                
                <p class="hero-description">
                    The complete toolkit for real estate professionals, investors, and home buyers. 
                    Calculate mortgage payments, analyze investments, estimate cash flow, and make informed decisions with our professional-grade calculators.
                </p>
                
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number">7</div>
                        <div class="stat-label">Professional Tools</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Free Forever</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Sign-up Required</div>
                    </div>
                </div>
                
                <div class="hero-cta">
                    <button id="get-started-btn" class="cta-button">
                        <i class="fas fa-rocket"></i>
                        Get Started - It's Free!
                    </button>
                    <p class="cta-note">Start calculating in seconds ‚Ä¢ No registration needed</p>
                </div>
            </div>
        </div>
        
        <div class="landing-features">
            <div class="features-container">
                <h2 class="features-title">Powerful Real Estate Calculators</h2>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3>Mortgage Calculator</h3>
                        <p>Calculate monthly payments including principal, interest, taxes, and insurance. Perfect for home buyers planning their budget.</p>
                        <div class="feature-tag">Most Popular</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Investment Analysis</h3>
                        <p>Analyze rental property investments with ROI calculations, cash flow projections, and long-term appreciation estimates.</p>
                        <div class="feature-tag">Pro Tool</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <h3>Cash Flow Calculator</h3>
                        <p>Calculate rental property cash flow with detailed expense breakdowns including management, maintenance, and vacancy rates.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <h3>Closing Costs</h3>
                        <p>Estimate all closing costs for buyers and sellers including commissions, taxes, fees, and title insurance.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h3>Buyer Cost Sheet</h3>
                        <p>Complete buyer cost breakdown including down payment, closing costs, moving expenses, and first-year costs.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <h3>Commission Calculator</h3>
                        <p>Calculate real estate commissions with custom splits, bonus structures, and celebration mode for closing day!</p>
                        <div class="feature-tag">Agent Favorite</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="landing-benefits">
            <div class="benefits-container">
                <div class="benefits-content">
                    <h2>Why Choose HouseMath.app?</h2>
                    
                    <div class="benefits-list">
                        <div class="benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="benefit-text">
                                <h4>Lightning Fast</h4>
                                <p>Instant calculations with real-time updates as you adjust parameters</p>
                            </div>
                        </div>
                        
                        <div class="benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="benefit-text">
                                <h4>Mobile Optimized</h4>
                                <p>Works perfectly on any device - desktop, tablet, or smartphone</p>
                            </div>
                        </div>
                        
                        <div class="benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-file-export"></i>
                            </div>
                            <div class="benefit-text">
                                <h4>Professional Reports</h4>
                                <p>Export beautiful PDF and JPG reports for clients and presentations</p>
                            </div>
                        </div>
                        
                        <div class="benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="benefit-text">
                                <h4>Privacy First</h4>
                                <p>All calculations happen in your browser - no data sent to servers</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="benefits-visual">
                    <div class="calculator-preview">
                        <div class="preview-screen">
                            <div class="preview-header">
                                <div class="preview-dot"></div>
                                <div class="preview-dot"></div>
                                <div class="preview-dot"></div>
                            </div>
                            <div class="preview-content">
                                <div class="preview-chart"></div>
                                <div class="preview-stats">
                                    <div class="preview-stat"></div>
                                    <div class="preview-stat"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="landing-cta-final">
            <div class="final-cta-content">
                <h2>Ready to Start Calculating?</h2>
                <p>Join thousands of real estate professionals who trust HouseMath.app for their calculations</p>
                <button id="get-started-btn-2" class="cta-button cta-button-large">
                    <i class="fas fa-calculator"></i>
                    Launch Calculator Suite
                </button>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <main role="main" class="container calculator-app" style="display: none;">
        <!-- SEO Description Section -->
        <section style="margin: 20px 0; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto;">
            <h2 style="font-size: 1.5rem; margin-bottom: 10px; color: var(--text-color);">Free Real Estate Calculators</h2>
            <p style="font-size: 1rem; line-height: 1.6; color: var(--text-color); opacity: 0.9;">
                Professional-grade real estate calculation tools for mortgage payments, investment property analysis, rental cash flow, closing costs, and commission calculations. Trusted by real estate agents, property investors, and home buyers nationwide.
            </p>
        </section>
        
        <!-- Calculator Navigation Tabs -->
        <div class="tabs" role="tablist" aria-label="Real Estate Calculator Tools">
            <div class="tab active" data-tab="mortgage" role="tab" aria-selected="true" aria-controls="mortgage-calculator" tabindex="0">Mortgage Calculator</div>
            <div class="tab" data-tab="investment" role="tab" aria-selected="false" aria-controls="investment-calculator" tabindex="-1">Investment Property</div>
            <div class="tab" data-tab="cashflow" role="tab" aria-selected="false" aria-controls="cashflow-calculator" tabindex="-1">Rental Cash Flow</div>
            <div class="tab" data-tab="closing" role="tab" aria-selected="false" aria-controls="closing-calculator" tabindex="-1">Closing Costs</div>
            <div class="tab" data-tab="buyer" role="tab" aria-selected="false" aria-controls="buyer-calculator" tabindex="-1">Buyer Cost Sheet</div>
            <div class="tab" data-tab="commission" role="tab" aria-selected="false" aria-controls="commission-calculator" tabindex="-1">Commission Calculator</div>
            <div class="tab" data-tab="comparison" role="tab" aria-selected="false" aria-controls="comparison-calculator" tabindex="-1">Property Comparison</div>
            <div class="tab" data-tab="report" role="tab" aria-selected="false" aria-controls="report-calculator" tabindex="-1">Generated Report</div>
        </div>



        <!-- Mortgage Calculator -->
        <section id="mortgage-calculator" class="calculator fade-in" role="tabpanel" aria-labelledby="mortgage-tab">
            <!-- Mortgage Calculator Inputs -->
            <article class="card">
                <h3 class="card-title"><i class="fas fa-home"></i> Mortgage Payment Calculator</h3>
                <p style="font-size: 0.875rem; margin-bottom: 20px; opacity: 0.8;">Calculate monthly mortgage payments including principal, interest, taxes, and insurance (PITI). Perfect for home buyers and real estate professionals.</p>
                
                <div class="form-group">
                    <label for="property-price">Property Price ($)</label>
                    <input type="number" id="property-price" value="350000">
                </div>
                
                <div class="form-group">
                    <label for="down-payment-slider">Down Payment (%)</label>
                    <div class="slider-container">
                        <input type="range" id="down-payment-slider" min="0" max="50" step="1" value="20">
                        <span id="down-payment-value" class="slider-value">20%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loan-term">Loan Term (years)</label>
                    <select id="loan-term">
                        <option value="15">15 years</option>
                        <option value="20">20 years</option>
                        <option value="30" selected>30 years</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="interest-rate-slider">Interest Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="interest-rate-slider" min="2" max="10" step="0.1" value="4.5">
                        <span id="interest-rate-value" class="slider-value">4.5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="property-tax">Property Tax ($/year)</label>
                    <input type="number" id="property-tax" value="3500">
                </div>
                
                <div class="form-group">
                    <label for="home-insurance">Home Insurance ($/year)</label>
                    <input type="number" id="home-insurance" value="1200">
                </div>
                
                <div class="form-group">
                    <label for="hoa">HOA Fees ($/month)</label>
                    <input type="number" id="hoa" value="0">
                </div>
                
                <button id="calculate-mortgage" class="btn-primary" style="width: 100%;">Calculate Mortgage</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="mortgage">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="mortgage">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="mortgage">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="mortgage" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Mortgage Calculator Results -->
            <article class="card">
                <h3 class="card-title">Monthly Payment Breakdown</h3>
                <p style="font-size: 0.875rem; margin-bottom: 20px; opacity: 0.8;">Detailed breakdown of your monthly mortgage payment including principal, interest, taxes, insurance, and total monthly cost.</p>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Principal & Interest</div>
                        <div class="stat-value" id="principal-interest">$1,425</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Total Monthly</div>
                        <div class="stat-value" id="total-monthly">$1,767</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="payment-chart"></canvas>
                </div>
                
                <div class="chart-container">
                    <canvas id="amortization-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Loan Summary</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Loan Amount:</div>
                        <div class="details-value" id="loan-amount">$280,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Down Payment:</div>
                        <div class="details-value" id="down-payment-amount">$70,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Total Interest Paid:</div>
                        <div class="details-value" id="total-interest">$233,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Total Cost:</div>
                        <div class="details-value" id="total-cost">$583,000</div>
                    </div>
                </div>
            </article>
        </section>

        <!-- Investment Property Calculator -->
        <section id="investment-calculator" class="calculator fade-in hidden" role="tabpanel" aria-labelledby="investment-tab">
            <!-- Investment Property Analysis Inputs -->
            <article class="card">
                <h3 class="card-title"><i class="fas fa-chart-line"></i> Investment Property Analysis</h3>
                <p style="font-size: 0.875rem; margin-bottom: 20px; opacity: 0.8;">Analyze rental property investments with ROI calculations, cash flow projections, and long-term appreciation estimates. Essential for property investors.</p>
                
                <div class="form-group">
                    <label for="inv-purchase-price">Purchase Price ($)</label>
                    <input type="number" id="inv-purchase-price" value="300000">
                </div>
                
                <div class="form-group">
                    <label for="annual-rent">Expected Annual Rent ($)</label>
                    <input type="number" id="annual-rent" value="24000">
                </div>
                
                <div class="form-group">
                    <label for="expenses-slider">Annual Property Expenses (%)</label>
                    <div class="slider-container">
                        <input type="range" id="expenses-slider" min="20" max="50" step="1" value="35">
                        <span id="expenses-value" class="slider-value">35%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="vacancy-slider">Vacancy Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="vacancy-slider" min="0" max="15" step="1" value="5">
                        <span id="vacancy-value" class="slider-value">5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="appreciation-slider">Annual Appreciation Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="appreciation-slider" min="0" max="10" step="0.5" value="3.5">
                        <span id="appreciation-value" class="slider-value">3.5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="holding-period">Holding Period (years)</label>
                    <select id="holding-period">
                        <option value="5">5 years</option>
                        <option value="10" selected>10 years</option>
                        <option value="15">15 years</option>
                        <option value="20">20 years</option>
                        <option value="30">30 years</option>
                    </select>
                </div>
                
                <button id="calculate-investment" class="btn-primary" style="width: 100%;">Calculate Investment Returns</button>
                
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="investment">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="investment">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="investment">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="investment" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">Investment Analysis</h2>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Cash-on-Cash ROI</div>
                        <div class="stat-value" id="cash-on-cash">8.4%</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Cap Rate</div>
                        <div class="stat-value" id="cap-rate">6.2%</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="investment-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Monthly Cash Flow</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Monthly Rent:</div>
                        <div class="details-value" id="monthly-rent">$2,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Monthly Expenses:</div>
                        <div class="details-value" id="monthly-expenses">$700</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Monthly Cash Flow:</div>
                        <div class="details-value" id="monthly-cashflow">$1,300</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Annual Cash Flow:</div>
                        <div class="details-value" id="annual-cashflow">$15,600</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Future Value</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Property Value After <span id="period-label">10</span> Years:</div>
                        <div class="details-value" id="future-property-value">$423,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Total Rental Income:</div>
                        <div class="details-value" id="total-rental-income">$240,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Total Return:</div>
                        <div class="details-value" id="total-return">$363,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Annualized Return:</div>
                        <div class="details-value" id="annualized-return">12.1%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rental Cash Flow Calculator -->
        <div id="cashflow-calculator" class="calculator fade-in hidden">
            <!-- Inputs -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-dollar-sign"></i> Rental Cash Flow Calculator</h2>
                
                <div class="form-group">
                    <label for="rental-income">Monthly Rental Income ($)</label>
                    <input type="number" id="rental-income" value="2000">
                </div>
                
                <div class="form-group">
                    <label for="mortgage-payment">Monthly Mortgage Payment ($)</label>
                    <input type="number" id="mortgage-payment" value="1000">
                </div>
                
                <div class="form-group">
                    <label for="rental-property-tax">Monthly Property Tax ($)</label>
                    <input type="number" id="rental-property-tax" value="150">
                </div>
                
                <div class="form-group">
                    <label for="rental-insurance">Monthly Home Insurance ($)</label>
                    <input type="number" id="rental-insurance" value="100">
                </div>
                
                <div class="form-group">
                    <label for="management-slider">Management Percent (%)</label>
                    <div class="slider-container">
                        <input type="range" id="management-slider" min="0" max="20" step="1" value="10">
                        <span id="management-value" class="slider-value">10%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="maintenance-slider">Maintenance Percent (%)</label>
                    <div class="slider-container">
                        <input type="range" id="maintenance-slider" min="0" max="10" step="1" value="5">
                        <span id="maintenance-value" class="slider-value">5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="vacancy-slider">Vacancy Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="vacancy-slider" min="0" max="15" step="1" value="5">
                        <span id="vacancy-value" class="slider-value">5%</span>
                    </div>
                </div>
                
                <button id="calculate-cashflow" class="btn-primary" style="width: 100%;">Calculate Cash Flow</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="cashflow">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="cashflow">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="cashflow">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="cashflow" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">Cash Flow Analysis</h2>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Gross Income:</div>
                        <div class="stat-value" id="gross-income">$2,400</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Total Expenses:</div>
                        <div class="stat-value" id="total-expenses">$1,150</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="cashflow-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Net Operating Income</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Gross Income:</div>
                        <div class="details-value" id="gross-income">$2,400</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Total Expenses:</div>
                        <div class="details-value" id="total-expenses">$1,150</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Net Operating Income:</div>
                        <div class="details-value" id="net-operating-income">$1,250</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Cash Flow</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Cash Flow Before Taxes:</div>
                        <div class="details-value" id="cash-flow-before-taxes">$1,250</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Cash Flow After Taxes:</div>
                        <div class="details-value" id="cash-flow-after-taxes">$1,250</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Closing Costs Calculator -->
        <div id="closing-calculator" class="calculator fade-in hidden">
            <!-- Inputs -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-file-invoice-dollar"></i> Closing Costs Calculator</h2>
                
                <div class="form-group">
                    <label for="closing-price">Sales Price ($)</label>
                    <input type="number" id="closing-price" value="350000">
                </div>
                
                <div class="form-group">
                    <label for="closing-mortgage">Mortgage Amount ($)</label>
                    <input type="number" id="closing-mortgage" value="280000">
                </div>
                
                <div class="form-group">
                    <label for="commission-rate">Commission Rate (%)</label>
                    <input type="number" id="commission-rate" value="6">
                </div>
                
                <div class="form-group">
                    <label for="deed-pages">Deed Pages</label>
                    <input type="number" id="deed-pages" value="2">
                </div>
                
                <div class="form-group">
                    <label for="mortgage-pages">Mortgage Pages</label>
                    <input type="number" id="mortgage-pages" value="20">
                </div>
                
                <button id="calculate-closing" class="btn-primary" style="width: 100%;">Calculate Closing Costs</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="closing">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="closing">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="closing">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="closing" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">Closing Costs</h2>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Buyer's Total:</div>
                        <div class="stat-value" id="buyer-total">$350,000</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Seller's Total:</div>
                        <div class="stat-value" id="seller-total">$350,000</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="closing-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Breakdown</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Mortgage Fees:</div>
                        <div class="details-value" id="mortgage-fees">$1,400</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Settlement Fee:</div>
                        <div class="details-value" id="settlement-fee">$595</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Title Search:</div>
                        <div class="details-value" id="title-search">$150</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Association Fee:</div>
                        <div class="details-value" id="association-fee">$250</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Survey:</div>
                        <div class="details-value" id="survey">$375</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Termite:</div>
                        <div class="details-value" id="termite">$100</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">New Lien Search Fee:</div>
                        <div class="details-value" id="lien-search">$75</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Commission:</div>
                        <div class="details-value" id="commission">$21,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Owner's Policy:</div>
                        <div class="details-value" id="owners-policy">$1,925</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Lender's Policy:</div>
                        <div class="details-value" id="lenders-policy">$1,925</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Environmental Endorsement:</div>
                        <div class="details-value" id="environmental">$100</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">ALTA 9-06:</div>
                        <div class="details-value" id="alta-9">$50</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">ALTA 5.1:</div>
                        <div class="details-value" id="alta-5">$25</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">ALTA 4.1:</div>
                        <div class="details-value" id="alta-4">$25</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Recording Fees:</div>
                        <div class="details-value" id="recording">$200</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Doc Stamp on Mortgage:</div>
                        <div class="details-value" id="doc-stamp-mortgage">$1,750</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Intangible Tax on Mortgage:</div>
                        <div class="details-value" id="intangible-tax">$1,400</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Doc Stamp on Deed:</div>
                        <div class="details-value" id="doc-stamp-deed">$1,750</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buyer Cost Sheet Calculator -->
        <div id="buyer-calculator" class="calculator fade-in hidden">
            <!-- Inputs -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-user-tie"></i> Buyer Cost Sheet Calculator</h2>
                
                <div class="form-group">
                    <label for="buyer-sales-price">Sales Price ($)</label>
                    <input type="number" id="buyer-sales-price" value="350000">
                </div>
                
                <div class="form-group">
                    <label for="buyer-down-payment">Down Payment ($)</label>
                    <input type="number" id="buyer-down-payment" value="70000">
                </div>
                
                <div class="form-group">
                    <label for="buyer-mortgage">Mortgage Amount ($)</label>
                    <input type="number" id="buyer-mortgage" value="280000">
                </div>
                
                <div class="form-group">
                    <label for="buyer-mortgage-rate">Mortgage Rate (%)</label>
                    <input type="number" id="buyer-mortgage-rate" value="4.5">
                </div>
                
                <div class="form-group">
                    <label for="buyer-points">Points (%)</label>
                    <input type="number" id="buyer-points" value="3">
                </div>
                
                <div class="form-group">
                    <label for="buyer-days-interest">Days Interest</label>
                    <input type="number" id="buyer-days-interest" value="180">
                </div>
                
                <button id="calculate-buyer" class="btn-primary" style="width: 100%;">Calculate Buyer Costs</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="buyer">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="buyer">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="buyer">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="buyer" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">Buyer Costs</h2>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Total:</div>
                        <div class="stat-value" id="buyer-total-due">$350,000</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Points Cost:</div>
                        <div class="stat-value" id="buyer-points-cost">$2,100</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="buyer-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Breakdown</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Mortgage:</div>
                        <div class="details-value" id="buyer-mortgage">$280,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Points:</div>
                        <div class="details-value" id="buyer-points">$2,100</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Interest:</div>
                        <div class="details-value" id="buyer-interest">$1,425</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Other Costs:</div>
                        <div class="details-value" id="buyer-other-costs">$1,425</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generated Report -->
        <div id="report-calculator" class="calculator fade-in hidden">
            <!-- Inputs -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-file-alt"></i> Report Generator</h2>
                
                <div class="form-group">
                    <label for="report-purchase-price">Purchase Price ($)</label>
                    <input type="number" id="report-purchase-price" value="350000">
                </div>
                
                <div class="form-group">
                    <label for="report-down-payment">Down Payment (%)</label>
                    <input type="number" id="report-down-payment" value="20">
                </div>
                
                <div class="form-group">
                    <label for="report-loan-term">Loan Term (years)</label>
                    <input type="number" id="report-loan-term" value="30">
                </div>
                
                <div class="form-group">
                    <label for="report-interest-rate">Interest Rate (%)</label>
                    <input type="number" id="report-interest-rate" value="4.5">
                </div>
                
                <div class="form-group">
                    <label for="report-property-tax">Property Tax ($/year)</label>
                    <input type="number" id="report-property-tax" value="3500">
                </div>
                
                <div class="form-group">
                    <label for="report-home-insurance">Home Insurance ($/year)</label>
                    <input type="number" id="report-home-insurance" value="1200">
                </div>
                
                <div class="form-group">
                    <label for="report-hoa">HOA Fees ($/month)</label>
                    <input type="number" id="report-hoa" value="0">
                </div>
                
                <div class="form-group">
                    <label for="report-rental-income">Monthly Rental Income ($)</label>
                    <input type="number" id="report-rental-income" value="2000">
                </div>
                
                <div class="form-group">
                    <label for="report-rental-property-tax">Monthly Property Tax ($)</label>
                    <input type="number" id="report-rental-property-tax" value="150">
                </div>
                
                <div class="form-group">
                    <label for="report-rental-insurance">Monthly Home Insurance ($)</label>
                    <input type="number" id="report-rental-insurance" value="100">
                </div>
                
                <div class="form-group">
                    <label for="report-management-slider">Management Percent (%)</label>
                    <div class="slider-container">
                        <input type="range" id="report-management-slider" min="0" max="20" step="1" value="10">
                        <span id="report-management-value" class="slider-value">10%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="report-maintenance-slider">Maintenance Percent (%)</label>
                    <div class="slider-container">
                        <input type="range" id="report-maintenance-slider" min="0" max="10" step="1" value="5">
                        <span id="report-maintenance-value" class="slider-value">5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="report-vacancy-slider">Vacancy Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="report-vacancy-slider" min="0" max="15" step="1" value="5">
                        <span id="report-vacancy-value" class="slider-value">5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="report-appreciation-slider">Annual Appreciation Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="report-appreciation-slider" min="0" max="10" step="0.5" value="3.5">
                        <span id="report-appreciation-value" class="slider-value">3.5%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="report-holding-period">Holding Period (years)</label>
                    <select id="report-holding-period">
                        <option value="5">5 years</option>
                        <option value="10" selected>10 years</option>
                        <option value="15">15 years</option>
                        <option value="20">20 years</option>
                        <option value="30">30 years</option>
                    </select>
                </div>
                
                <button id="generate-report" class="btn-primary" style="width: 100%;">Generate Report</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="report">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="report">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="report">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="report" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">Report</h2>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Total Investment:</div>
                        <div class="stat-value" id="report-total-investment">$70,000</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Total Return:</div>
                        <div class="stat-value" id="report-total-return">$583,000</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="report-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">Breakdown</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Principal & Interest:</div>
                        <div class="details-value" id="report-principal-interest">$1,425</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Property Tax:</div>
                        <div class="details-value" id="report-property-tax">$350</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Insurance:</div>
                        <div class="details-value" id="report-home-insurance">$120</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">HOA Fees:</div>
                        <div class="details-value" id="report-hoa">$0</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Management:</div>
                        <div class="details-value" id="report-management">$167</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Maintenance:</div>
                        <div class="details-value" id="report-maintenance">$83</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Vacancy:</div>
                        <div class="details-value" id="report-vacancy">$167</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Total Cash Flow:</div>
                        <div class="details-value" id="report-cash-flow">$1,767</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Commission Calculator -->
        <div id="commission-calculator" class="calculator fade-in hidden">
            <!-- Inputs -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-percentage"></i> Real Estate Commission Calculator</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Calculate your commission earnings and splits with precision</p>
                
                <div class="form-group">
                    <label for="sale-price">Sale Price ($)</label>
                    <input type="number" id="sale-price" value="450000">
                </div>
                
                <div class="form-group">
                    <label for="commission-rate-slider">Total Commission Rate (%)</label>
                    <div class="slider-container">
                        <input type="range" id="commission-rate-slider" min="4" max="8" step="0.25" value="6">
                        <span id="commission-rate-display" class="slider-value">6%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="listing-split-slider">Listing Agent Split (%)</label>
                    <div class="slider-container">
                        <input type="range" id="listing-split-slider" min="40" max="100" step="5" value="70">
                        <span id="listing-split-display" class="slider-value">70%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="selling-split-slider">Selling Agent Split (%)</label>
                    <div class="slider-container">
                        <input type="range" id="selling-split-slider" min="40" max="100" step="5" value="70">
                        <span id="selling-split-display" class="slider-value">70%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="transaction-fee">Transaction Fee ($)</label>
                    <input type="number" id="transaction-fee" value="395">
                </div>
                
                <div class="form-group">
                    <label for="agent-role">You are the:</label>
                    <select id="agent-role">
                        <option value="listing">Listing Agent</option>
                        <option value="selling">Selling Agent</option>
                        <option value="both">Both (Dual Agency)</option>
                    </select>
                </div>
                
                <button id="calculate-commission" class="btn-primary" style="width: 100%;">Calculate Commission</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="commission">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="commission">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="commission">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="commission" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">üí∞ Commission Breakdown</h2>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Your Gross Commission</div>
                        <div class="stat-value" id="your-gross-commission">$18,900</div>
                    </div>
                    
                    <div class="stat-box">
                        <div class="stat-label">Your Net Commission</div>
                        <div class="stat-value" id="your-net-commission">$18,505</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="commission-chart"></canvas>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">üí∏ Commission Details</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Total Commission:</div>
                        <div class="details-value" id="total-commission">$27,000</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Listing Side:</div>
                        <div class="details-value" id="listing-side-total">$13,500</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Selling Side:</div>
                        <div class="details-value" id="selling-side-total">$13,500</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Your Commission (Before Fees):</div>
                        <div class="details-value" id="your-commission-before-fees">$18,900</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Transaction Fees:</div>
                        <div class="details-value" id="total-fees">$395</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Your Net Commission:</div>
                        <div class="details-value" id="final-commission" style="font-weight: 700; color: #10b981;">$18,505</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Property Comparison Calculator -->
        <div id="comparison-calculator" class="calculator fade-in hidden">
            <!-- Inputs -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-balance-scale"></i> Property Comparison Tool</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Compare up to 3 properties side-by-side for your clients</p>
                
                <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--primary-color);">üè† Property A</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyA-price">Price ($)</label>
                            <input type="number" id="propertyA-price" value="425000">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyA-sqft">Square Feet</label>
                            <input type="number" id="propertyA-sqft" value="2100">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyA-bedrooms">Bedrooms</label>
                            <input type="number" id="propertyA-bedrooms" value="3">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyA-bathrooms">Bathrooms</label>
                            <input type="number" id="propertyA-bathrooms" value="2.5" step="0.5">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyA-hoa">HOA ($/month)</label>
                            <input type="number" id="propertyA-hoa" value="150">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyA-year">Year Built</label>
                            <input type="number" id="propertyA-year" value="2018">
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; color: #10b981;">üè† Property B</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyB-price">Price ($)</label>
                            <input type="number" id="propertyB-price" value="395000">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyB-sqft">Square Feet</label>
                            <input type="number" id="propertyB-sqft" value="1950">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyB-bedrooms">Bedrooms</label>
                            <input type="number" id="propertyB-bedrooms" value="3">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyB-bathrooms">Bathrooms</label>
                            <input type="number" id="propertyB-bathrooms" value="2" step="0.5">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyB-hoa">HOA ($/month)</label>
                            <input type="number" id="propertyB-hoa" value="0">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyB-year">Year Built</label>
                            <input type="number" id="propertyB-year" value="2015">
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; color: #ec4899;">üè† Property C</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyC-price">Price ($)</label>
                            <input type="number" id="propertyC-price" value="475000">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyC-sqft">Square Feet</label>
                            <input type="number" id="propertyC-sqft" value="2300">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyC-bedrooms">Bedrooms</label>
                            <input type="number" id="propertyC-bedrooms" value="4">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyC-bathrooms">Bathrooms</label>
                            <input type="number" id="propertyC-bathrooms" value="3" step="0.5">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyC-hoa">HOA ($/month)</label>
                            <input type="number" id="propertyC-hoa" value="200">
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="propertyC-year">Year Built</label>
                            <input type="number" id="propertyC-year" value="2020">
                        </div>
                    </div>
                </div>
                
                <button id="calculate-comparison" class="btn-primary" style="width: 100%;">Compare Properties</button>
                <div class="export-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <div class="dropdown">
                        <button class="btn-primary dropdown-btn" style="display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-file-pdf"></i> Export PDF <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" class="export-option" data-type="pdf" data-content="current" data-source="comparison">Current View</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="summary" data-source="comparison">Summary Only</a>
                            <a href="#" class="export-option" data-type="pdf" data-content="full" data-source="comparison">Full Report</a>
                        </div>
                    </div>
                    <button class="btn-green export-option" data-type="jpg" data-content="current" data-source="comparison" style="display: flex; align-items: center; gap: 5px;">
                        <i class="far fa-file-image"></i> JPG
                    </button>
                </div>
            </div>
            
            <!-- Results -->
            <div class="card">
                <h2 class="card-title">üìä Property Comparison Results</h2>
                
                <div class="chart-container">
                    <canvas id="comparison-chart"></canvas>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <h4 style="margin: 0 0 10px 0; color: var(--primary-color);">Property A</h4>
                        <div class="stat-value" id="propertyA-price-per-sqft">$202/sqft</div>
                        <div class="stat-label">Price per Sq Ft</div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <h4 style="margin: 0 0 10px 0; color: #10b981;">Property B</h4>
                        <div class="stat-value" id="propertyB-price-per-sqft">$203/sqft</div>
                        <div class="stat-label">Price per Sq Ft</div>
                    </div>
                    <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                        <h4 style="margin: 0 0 10px 0; color: #ec4899;">Property C</h4>
                        <div class="stat-value" id="propertyC-price-per-sqft">$207/sqft</div>
                        <div class="stat-label">Price per Sq Ft</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 15px; font-size: 1.125rem; font-weight: 500;">üèÜ Best Value Analysis</h3>
                <div class="details-table">
                    <div class="details-row">
                        <div class="details-label">Best Price per Sq Ft:</div>
                        <div class="details-value" id="best-price-per-sqft">Property A</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Most Bedrooms:</div>
                        <div class="details-value" id="most-bedrooms">Property C (4 bedrooms)</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Newest Property:</div>
                        <div class="details-value" id="newest-property">Property C (2020)</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Lowest HOA:</div>
                        <div class="details-value" id="lowest-hoa">Property B ($0/month)</div>
                    </div>
                    <div class="details-row">
                        <div class="details-label">Recommended Choice:</div>
                        <div class="details-value" id="recommended-choice" style="font-weight: 700; color: #10b981;">Property A</div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    
    <script>
        // Chart variables
        let paymentChart, amortizationChart, investmentChart, expenseChart, commissionChart, comparisonChart, closingChart;
        
        // Landing Page Controller
        class LandingPageController {
            constructor() {
                this.landingPage = document.getElementById('landing-page');
                this.calculatorApp = document.querySelector('.calculator-app');
                this.initEventListeners();
            }

            initEventListeners() {
                // Get Started buttons
                const getStartedBtn1 = document.getElementById('get-started-btn');
                const getStartedBtn2 = document.getElementById('get-started-btn-2');
                
                if (getStartedBtn1) {
                    getStartedBtn1.addEventListener('click', () => this.enterApp());
                }
                
                if (getStartedBtn2) {
                    getStartedBtn2.addEventListener('click', () => this.enterApp());
                }

                // Handle browser back button
                window.addEventListener('popstate', (e) => {
                    if (e.state && e.state.page === 'landing') {
                        this.showLandingPage();
                    }
                });

                // Add smooth scrolling for feature card clicks
                document.querySelectorAll('.feature-card').forEach(card => {
                    card.addEventListener('click', () => this.enterApp());
                });
            }

            enterApp() {
                // Add smooth transition
                this.landingPage.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                this.landingPage.style.opacity = '0';
                this.landingPage.style.transform = 'translateY(-20px)';
                
                // Show calculator app after transition
                setTimeout(() => {
                    this.landingPage.style.display = 'none';
                    
                    // Show header and navigation
                    const appHeader = document.querySelector('.app-header');
                    const appNavigation = document.querySelector('.app-navigation');
                    if (appHeader) appHeader.style.display = 'block';
                    if (appNavigation) appNavigation.style.display = 'block';
                    
                    this.calculatorApp.style.display = 'block';
                    this.calculatorApp.style.opacity = '0';
                    this.calculatorApp.style.transform = 'translateY(20px)';
                    
                    // Animate in the calculator app
                    setTimeout(() => {
                        this.calculatorApp.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        this.calculatorApp.style.opacity = '1';
                        this.calculatorApp.style.transform = 'translateY(0)';
                        
                        // Update browser history
                        history.pushState({page: 'calculator'}, 'HouseMath.app Calculator', '#calculator');
                        
                        // Trigger any calculator initialization
                        this.initializeCalculators();
                    }, 50);
                }, 500);
            }

            showLandingPage() {
                this.calculatorApp.style.display = 'none';
                
                // Hide header and navigation
                const appHeader = document.querySelector('.app-header');
                const appNavigation = document.querySelector('.app-navigation');
                if (appHeader) appHeader.style.display = 'none';
                if (appNavigation) appNavigation.style.display = 'none';
                
                this.landingPage.style.display = 'block';
                this.landingPage.style.opacity = '1';
                this.landingPage.style.transform = 'translateY(0)';
            }

            initializeCalculators() {
                // Initialize first calculator
                const mortgageCalculator = document.getElementById('mortgage-calculator');
                if (mortgageCalculator) {
                    mortgageCalculator.classList.remove('hidden');
                    
                    // Trigger initial calculation
                    setTimeout(() => {
                        const calculateBtn = document.getElementById('calculate-mortgage');
                        if (calculateBtn) {
                            calculateBtn.click();
                        }
                    }, 100);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize landing page controller
            const landingController = new LandingPageController();

            // Real MLS API Functions
            class MLSAPIManager {
                constructor() {
                    this.cache = new Map();
                    this.cacheExpiry = 5 * 60 * 1000; // 5 minutes
                }

                async searchProperties(searchCriteria) {
                    // Check which data source to use
                    if (DATA_CONFIG.mls.bridge.enabled && DATA_CONFIG.mls.bridge.apiKey) {
                        return await this.searchBridgeAPI(searchCriteria);
                    } else if (DATA_CONFIG.mls.spark.enabled && DATA_CONFIG.mls.spark.apiKey) {
                        return await this.searchSparkAPI(searchCriteria);
                    } else if (DATA_CONFIG.alternative.rentals.rentalsApi.enabled) {
                        return await this.searchRentalsAPI(searchCriteria);
                    } else if (DATA_CONFIG.alternative.scraping.scrapingBee.enabled) {
                        return await this.searchScrapingAPI(searchCriteria);
                    } else if (DATA_CONFIG.alternative.publicRecords.enabled) {
                        return await this.searchPublicRecords(searchCriteria);
                    } else {
                        // No data sources configured
                        return [];
                    }
                }

                async searchBridgeAPI(searchCriteria) {
                    try {
                        const { searchTerm, minPrice, maxPrice, minBedrooms, minBathrooms, propertyType, status, city, state } = searchCriteria;
                        
                        // Build OData query for Bridge API
                        let filters = [];
                        
                        if (minPrice > 0) filters.push(`ListPrice ge ${minPrice}`);
                        if (maxPrice < Infinity) filters.push(`ListPrice le ${maxPrice}`);
                        if (minBedrooms > 0) filters.push(`BedroomsTotal ge ${minBedrooms}`);
                        if (minBathrooms > 0) filters.push(`BathroomsTotal ge ${minBathrooms}`);
                        if (propertyType) filters.push(`PropertyType eq '${propertyType}'`);
                        if (status !== 'all') filters.push(`StandardStatus eq '${status}'`);
                        if (city) filters.push(`City eq '${city}'`);
                        if (state) filters.push(`StateOrProvince eq '${state}'`);
                        
                        const filterQuery = filters.length > 0 ? `$filter=${filters.join(' and ')}` : '';
                        const searchQuery = searchTerm ? `$search="${searchTerm}"` : '';
                        const params = [filterQuery, searchQuery, '$top=50'].filter(p => p).join('&');
                        
                        const response = await fetch(`${DATA_CONFIG.mls.bridge.baseUrl}/Property?${params}`, {
                            headers: {
                                'Authorization': `Bearer ${DATA_CONFIG.mls.bridge.apiKey}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`API Error: ${response.status}`);
                        }

                        const data = await response.json();
                        return this.normalizeBridgeData(data.value || []);
                        
                    } catch (error) {
                        console.error('Bridge API Error:', error);
                        // Return empty array on API error
                        return [];
                    }
                }

                async searchSparkAPI(searchCriteria) {
                    try {
                        const { searchTerm, minPrice, maxPrice, minBedrooms, minBathrooms, propertyType, status } = searchCriteria;
                        
                        // Build Spark API query
                        let filters = [];
                        
                        if (minPrice > 0) filters.push(`ListPrice Ge ${minPrice}`);
                        if (maxPrice < Infinity) filters.push(`ListPrice Le ${maxPrice}`);
                        if (minBedrooms > 0) filters.push(`BedroomsTotal Ge ${minBedrooms}`);
                        if (minBathrooms > 0) filters.push(`BathroomsTotal Ge ${minBathrooms}`);
                        if (propertyType) filters.push(`PropertyType Eq '${propertyType}'`);
                        if (status !== 'all') filters.push(`MlsStatus Eq '${status}'`);
                        
                        const filterQuery = filters.length > 0 ? filters.join(' And ') : '';
                        const params = new URLSearchParams({
                            _limit: '50',
                            _filter: filterQuery
                        });

                        const response = await fetch(`${DATA_CONFIG.mls.spark.baseUrl}/listings?${params}`, {
                            headers: {
                                'X-SparkApi-User-Agent': 'HouseMath.app/1.0',
                                'Authorization': `OAuth ${DATA_CONFIG.mls.spark.apiKey}`
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`Spark API Error: ${response.status}`);
                        }

                        const data = await response.json();
                        return this.normalizeSparkData(data.D.Results || []);
                        
                    } catch (error) {
                        console.error('Spark API Error:', error);
                        // Return empty array on API error
                        return [];
                    }
                }



                normalizeBridgeData(properties) {
                    return properties.map(prop => ({
                        id: prop.ListingKey || prop.ListingId,
                        address: `${prop.UnparsedAddress || ''}, ${prop.City || ''}, ${prop.StateOrProvince || ''} ${prop.PostalCode || ''}`.trim(),
                        price: prop.ListPrice || 0,
                        bedrooms: prop.BedroomsTotal || 0,
                        bathrooms: prop.BathroomsTotal || 0,
                        sqft: prop.LivingArea || 0,
                        propertyType: this.normalizePropertyType(prop.PropertyType),
                        status: prop.StandardStatus?.toLowerCase() || 'active',
                        listDate: prop.ListingContractDate || prop.OnMarketDate,
                        photo: prop.Media?.[0]?.MediaURL || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400&h=300&fit=crop',
                        propertyTax: this.estimatePropertyTax(prop.ListPrice),
                        hoa: prop.AssociationFee || 0,
                        insurance: this.estimateInsurance(prop.ListPrice),
                        estimatedRent: this.estimateRent(prop.ListPrice),
                        description: prop.PublicRemarks || 'No description available',
                        yearBuilt: prop.YearBuilt || null,
                        lotSize: prop.LotSizeAcres || 0
                    }));
                }

                normalizeSparkData(properties) {
                    return properties.map(prop => ({
                        id: prop.Id,
                        address: `${prop.Address}, ${prop.City}, ${prop.StateOrProvince} ${prop.PostalCode}`,
                        price: prop.ListPrice || 0,
                        bedrooms: prop.BedroomsTotal || 0,
                        bathrooms: prop.BathroomsTotal || 0,
                        sqft: prop.BuildingAreaTotal || 0,
                        propertyType: this.normalizePropertyType(prop.PropertyType),
                        status: prop.MlsStatus?.toLowerCase() || 'active',
                        listDate: prop.ListingContractDate,
                        photo: prop.Photos?.[0]?.Uri800 || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400&h=300&fit=crop',
                        propertyTax: this.estimatePropertyTax(prop.ListPrice),
                        hoa: prop.AssociationFee || 0,
                        insurance: this.estimateInsurance(prop.ListPrice),
                        estimatedRent: this.estimateRent(prop.ListPrice),
                        description: prop.PublicRemarks || 'No description available',
                        yearBuilt: prop.YearBuilt || null,
                        lotSize: prop.LotSizeAcres || 0
                    }));
                }

                normalizePropertyType(type) {
                    if (!type) return 'single-family';
                    const normalized = type.toLowerCase();
                    if (normalized.includes('condo') || normalized.includes('condominium')) return 'condo';
                    if (normalized.includes('townhouse') || normalized.includes('townhome')) return 'townhouse';
                    return 'single-family';
                }

                estimatePropertyTax(price) {
                    return Math.round(price * 0.01); // 1% estimate
                }

                estimateInsurance(price) {
                    return Math.round(price * 0.003); // 0.3% estimate
                }

                estimateRent(price) {
                    return Math.round(price * 0.005); // 0.5% rule estimate
                }

                // Alternative Data Source Methods
                async searchRentalsAPI(searchCriteria) {
                    try {
                        const { searchTerm, minPrice, maxPrice, city, state } = searchCriteria;
                        
                        const params = new URLSearchParams({
                            'location': `${city}, ${state}` || 'Austin, TX',
                            'min_price': minPrice || 0,
                            'max_price': maxPrice || 999999,
                            'limit': 20
                        });

                        // Note: This is a conceptual example - actual API may differ
                        const response = await fetch(`${DATA_CONFIG.alternative.rentals.rentalsApi.baseUrl}/search?${params}`, {
                            headers: {
                                'Authorization': `Bearer ${DATA_CONFIG.alternative.rentals.rentalsApi.apiKey}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`Rentals API Error: ${response.status}`);
                        }

                        const data = await response.json();
                        return this.normalizeRentalsData(data.properties || []);
                        
                    } catch (error) {
                        console.error('Rentals API Error:', error);
                        return [];
                    }
                }

                async searchScrapingAPI(searchCriteria) {
                    try {
                        const { searchTerm, city, state, minPrice, maxPrice } = searchCriteria;
                        
                        // Build search URL with filters
                        let searchUrl = `https://www.zillow.com/homes/`;
                        if (city && state) {
                            searchUrl += `${city.replace(/\s+/g, '-')}-${state}_rb/`;
                        } else {
                            searchUrl += `for_sale/`;
                        }
                        
                        // Add price filters to URL
                        if (minPrice || maxPrice) {
                            const priceFilter = `${minPrice || '0'}-${maxPrice || ''}price`;
                            searchUrl += `${priceFilter}/`;
                        }
                        
                        // Build ScrapingBee API URL with parameters
                        const apiUrl = new URL(DATA_CONFIG.alternative.scraping.scrapingBee.baseUrl);
                        apiUrl.searchParams.append('api_key', DATA_CONFIG.alternative.scraping.scrapingBee.apiKey);
                        apiUrl.searchParams.append('url', searchUrl);
                        apiUrl.searchParams.append('wait', '3000'); // Wait for JavaScript to load
                        apiUrl.searchParams.append('window_width', '1920');
                        apiUrl.searchParams.append('window_height', '1080');
                        
                        // Debug logging removed for production

                        const response = await fetch(apiUrl.toString(), {
                            method: 'GET',
                            headers: {
                                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                            }
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error('ScrapingBee Error Response:', errorText);
                            throw new Error(`Scraping API Error: ${response.status} - ${errorText}`);
                        }

                        const html = await response.text();
                        
                        return this.parseScrapedData(html, searchCriteria);
                        
                    } catch (error) {
                        console.error('Scraping API Error:', error);
                        return [];
                    }
                }

                async searchPublicRecords(searchCriteria) {
                    try {
                        const { city, state } = searchCriteria;
                        
                        // Example: Search county assessor records
                        const countyApi = DATA_CONFIG.alternative.publicRecords.sources[0].url;
                        const params = new URLSearchParams({
                            'city': city || 'Austin',
                            'state': state || 'TX',
                            'limit': 20
                        });

                        const response = await fetch(`${countyApi}/properties?${params}`);

                        if (!response.ok) {
                            throw new Error(`Public Records API Error: ${response.status}`);
                        }

                        const data = await response.json();
                        return this.normalizePublicRecordsData(data.records || []);
                        
                    } catch (error) {
                        console.error('Public Records API Error:', error);
                        return [];
                    }
                }

                normalizeRentalsData(properties) {
                    return properties.map(prop => ({
                        id: prop.id || `RENT_${Math.random().toString(36).substr(2, 9)}`,
                        address: prop.address || 'Address not available',
                        price: prop.rent || prop.price || 0,
                        bedrooms: prop.bedrooms || 0,
                        bathrooms: prop.bathrooms || 0,
                        sqft: prop.square_feet || prop.sqft || 0,
                        propertyType: 'rental',
                        status: 'active',
                        listDate: prop.date_listed || new Date().toISOString().split('T')[0],
                        photo: prop.photos?.[0] || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400&h=300&fit=crop',
                        propertyTax: 0, // Not applicable for rentals
                        hoa: prop.hoa_fee || 0,
                        insurance: 0, // Tenant insurance separate
                        estimatedRent: prop.rent || prop.price || 0,
                        description: prop.description || 'Rental property',
                        yearBuilt: prop.year_built || null,
                        lotSize: 0
                    }));
                }

                parseScrapedData(html, searchCriteria) {
                    try {
                        
                        // Create DOM parser to work with the HTML
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        const properties = [];
                        
                        // Try multiple selectors to find property listings
                        const selectors = [
                            'article[data-test="property-card"]', // Zillow property cards
                            '[data-testid="property-card"]', // Alternative selector
                            '.property-card', // Generic property card
                            '.ListItem', // Zillow list item
                            '[role="listitem"]' // Generic list item
                        ];
                        
                        let propertyElements = [];
                        for (const selector of selectors) {
                            propertyElements = doc.querySelectorAll(selector);
                            if (propertyElements.length > 0) {
                                break;
                            }
                        }
                        
                        // If no structured elements found, try to extract from JSON data
                        if (propertyElements.length === 0) {
                            return this.extractFromZillowJSON(html, searchCriteria);
                        }
                        
                        // Parse each property element
                        propertyElements.forEach((element, index) => {
                            try {
                                const property = this.extractPropertyFromElement(element, index);
                                if (property && property.price > 0) {
                                    properties.push(property);
                                }
                            } catch (err) {
                                // Skip invalid property elements
                            }
                        });
                        
                        return properties.slice(0, 20); // Limit to 20 properties
                        
                    } catch (error) {
                        console.error('HTML parsing error:', error);
                        // Return fallback data to help with debugging
                        return this.createFallbackData(searchCriteria);
                    }
                }

                extractPropertyFromElement(element, index) {
                    try {
                        // Extract basic property information
                        const addressElement = element.querySelector('[data-test="property-card-addr"], .property-card-addr, .address, [aria-label*="address"]');
                        const priceElement = element.querySelector('[data-test="property-card-price"], .price, [aria-label*="price"]');
                        const bedsElement = element.querySelector('[data-test="property-card-beds"], .beds, [aria-label*="bed"]');
                        const bathsElement = element.querySelector('[data-test="property-card-baths"], .baths, [aria-label*="bath"]');
                        const sqftElement = element.querySelector('[data-test="property-card-sqft"], .sqft, [aria-label*="square feet"]');
                        const imageElement = element.querySelector('img[src*="zillow"], img[alt*="property"], img');
                        
                        // Extract text content and clean it
                        const address = this.cleanText(addressElement?.textContent || '');
                        const priceText = this.cleanText(priceElement?.textContent || '');
                        const bedsText = this.cleanText(bedsElement?.textContent || '');
                        const bathsText = this.cleanText(bathsElement?.textContent || '');
                        const sqftText = this.cleanText(sqftElement?.textContent || '');
                        
                        // Parse numeric values
                        const price = this.parsePrice(priceText);
                        const bedrooms = this.parseNumber(bedsText);
                        const bathrooms = this.parseNumber(bathsText);
                        const sqft = this.parseNumber(sqftText);
                        
                        // Skip if essential data is missing
                        if (!address || !price) {
                            return null;
                        }
                        
                        return {
                            id: `SCRAPED_${Math.random().toString(36).substr(2, 9)}`,
                            address: address || 'Address not available',
                            price: price || 0,
                            bedrooms: bedrooms || 0,
                            bathrooms: bathrooms || 0,
                            sqft: sqft || 0,
                            propertyType: 'house', // Default type
                            status: 'active',
                            listDate: new Date().toISOString().split('T')[0],
                            photo: imageElement?.src || 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400&h=300&fit=crop',
                            propertyTax: this.estimatePropertyTax(price),
                            hoa: 0,
                            insurance: this.estimateInsurance(price),
                            estimatedRent: this.estimateRent(price),
                            description: 'Property found via web scraping',
                            yearBuilt: null,
                            lotSize: 0
                        };
                    } catch (error) {
                        return null;
                    }
                }

                extractFromZillowJSON(html, searchCriteria) {
                    try {
                        // Look for JSON data embedded in the page
                        const jsonMatches = html.match(/"searchResults":\s*{[^}]+}|"results":\s*\[[^\]]+\]|"listResults":\s*\[[^\]]+\]/g);
                        
                        if (jsonMatches) {
                            // This is a simplified approach - full implementation would be more complex
                            return this.createFallbackData(searchCriteria);
                        }
                        
                        return this.createFallbackData(searchCriteria);
                    } catch (error) {
                        return this.createFallbackData(searchCriteria);
                    }
                }

                createFallbackData(searchCriteria) {
                    // Provide helpful feedback when scraping doesn't work
                    const { city, state } = searchCriteria;
                    const location = city && state ? `${city}, ${state}` : 'your area';
                    
                    return [{
                        id: 'SCRAPING_INFO',
                        address: `Web scraping status for ${location}`,
                        price: 0,
                        bedrooms: 0,
                        bathrooms: 0,
                        sqft: 0,
                        propertyType: 'info',
                        status: 'info',
                        listDate: new Date().toISOString().split('T')[0],
                        photo: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400&h=300&fit=crop',
                        propertyTax: 0,
                        hoa: 0,
                        insurance: 0,
                        estimatedRent: 0,
                        description: 'ScrapingBee connected successfully, but no property listings could be extracted from the HTML. This may be due to website structure changes or anti-scraping measures. Consider using MLS or alternative data sources for reliable property data.',
                        yearBuilt: null,
                        lotSize: 0
                    }];
                }

                cleanText(text) {
                    return text ? text.trim().replace(/\s+/g, ' ') : '';
                }

                parsePrice(priceText) {
                    if (!priceText) return 0;
                    // Extract numbers from price text like "$450,000" or "$450K"
                    const match = priceText.match(/[\d,]+/);
                    if (match) {
                        let price = parseInt(match[0].replace(/,/g, ''));
                        // Handle K (thousands) and M (millions)
                        if (priceText.toLowerCase().includes('k')) {
                            price *= 1000;
                        } else if (priceText.toLowerCase().includes('m')) {
                            price *= 1000000;
                        }
                        return price;
                    }
                    return 0;
                }

                parseNumber(text) {
                    if (!text) return 0;
                    const match = text.match(/\d+(\.\d+)?/);
                    return match ? parseFloat(match[0]) : 0;
                }

                normalizePublicRecordsData(records) {
                    return records.map(record => ({
                        id: record.parcel_id || `PUBLIC_${Math.random().toString(36).substr(2, 9)}`,
                        address: record.property_address || 'Address not available',
                        price: record.assessed_value || record.market_value || 0,
                        bedrooms: record.bedrooms || 0,
                        bathrooms: record.bathrooms || 0,
                        sqft: record.living_area || record.total_area || 0,
                        propertyType: this.normalizePropertyType(record.property_type),
                        status: 'public_record',
                        listDate: record.last_sale_date || new Date().toISOString().split('T')[0],
                        photo: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400&h=300&fit=crop',
                        propertyTax: record.annual_tax || this.estimatePropertyTax(record.assessed_value),
                        hoa: 0,
                        insurance: this.estimateInsurance(record.assessed_value),
                        estimatedRent: this.estimateRent(record.assessed_value),
                        description: 'Public record data - may not reflect current listing status',
                        yearBuilt: record.year_built || null,
                        lotSize: record.lot_size || 0
                    }));
                }
            }











            // Add save/load functionality for calculations
            function saveCalculation(name, data) {
                try {
                    const savedCalcs = JSON.parse(localStorage.getItem('savedCalculations') || '{}');
                    savedCalcs[name] = {
                        ...data,
                        savedAt: new Date().toISOString(),
                        id: Math.random().toString(36).substr(2, 9)
                    };
                    localStorage.setItem('savedCalculations', JSON.stringify(savedCalcs));
                    alert(`‚úÖ Calculation saved as "${name}"`);
                    return true;
                } catch (e) {
                    alert('‚ùå Failed to save calculation');
                    return false;
                }
            }

            function loadCalculation(name) {
                try {
                    const savedCalcs = JSON.parse(localStorage.getItem('savedCalculations') || '{}');
                    if (savedCalcs[name]) {
                        populateFormFromData(savedCalcs[name]);
                        return true;
                    }
                } catch (e) {
                    alert('‚ùå Failed to load calculation');
                }
                return false;
            }



            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + S to save current calculation
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    const name = prompt('Save calculation as:');
                    if (name) {
                        const currentTab = document.querySelector('.tab.active')?.dataset.tab;
                        if (currentTab) {
                            const data = extractCurrentCalculationData(currentTab);
                            saveCalculation(name, data);
                        }
                    }
                }
                
                // Ctrl/Cmd + L to load calculation
                if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                    e.preventDefault();
                    showSavedCalculations();
                }
                
                // ESC to close any open dropdowns
                if (e.key === 'Escape') {
                    document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                        dropdown.style.display = 'none';
                    });
                }
            });

            function extractCurrentCalculationData(tabName) {
                const data = { type: tabName };
                
                // Extract form data based on current tab
                switch(tabName) {
                    case 'mortgage':
                        data.propertyPrice = document.getElementById('property-price')?.value;
                        data.downPayment = document.getElementById('down-payment-slider')?.value;
                        data.loanTerm = document.getElementById('loan-term')?.value;
                        data.interestRate = document.getElementById('interest-rate-slider')?.value;
                        data.propertyTax = document.getElementById('property-tax')?.value;
                        data.homeInsurance = document.getElementById('home-insurance')?.value;
                        data.hoa = document.getElementById('hoa')?.value;
                        break;
                    case 'investment':
                        data.purchasePrice = document.getElementById('inv-purchase-price')?.value;
                        data.annualRent = document.getElementById('annual-rent')?.value;
                        data.expenses = document.getElementById('expenses-slider')?.value;
                        data.vacancy = document.getElementById('vacancy-slider')?.value;
                        data.appreciation = document.getElementById('appreciation-slider')?.value;
                        data.holdingPeriod = document.getElementById('holding-period')?.value;
                        break;
                    case 'cashflow':
                        data.rentalIncome = document.getElementById('rental-income')?.value;
                        data.mortgagePayment = document.getElementById('mortgage-payment')?.value;
                        data.propertyTax = document.getElementById('rental-property-tax')?.value;
                        data.insurance = document.getElementById('rental-insurance')?.value;
                        break;
                    case 'commission':
                        data.salePrice = document.getElementById('sale-price')?.value;
                        data.commissionRate = document.getElementById('commission-rate-slider')?.value;
                        data.listingSplit = document.getElementById('listing-split-slider')?.value;
                        data.sellingSplit = document.getElementById('selling-split-slider')?.value;
                        data.transactionFee = document.getElementById('transaction-fee')?.value;
                        data.agentRole = document.getElementById('agent-role')?.value;
                        break;
                    case 'comparison':
                        data.propertyA = {
                            price: document.getElementById('propertyA-price')?.value,
                            sqft: document.getElementById('propertyA-sqft')?.value,
                            bedrooms: document.getElementById('propertyA-bedrooms')?.value,
                            bathrooms: document.getElementById('propertyA-bathrooms')?.value,
                            hoa: document.getElementById('propertyA-hoa')?.value,
                            year: document.getElementById('propertyA-year')?.value
                        };
                        data.propertyB = {
                            price: document.getElementById('propertyB-price')?.value,
                            sqft: document.getElementById('propertyB-sqft')?.value,
                            bedrooms: document.getElementById('propertyB-bedrooms')?.value,
                            bathrooms: document.getElementById('propertyB-bathrooms')?.value,
                            hoa: document.getElementById('propertyB-hoa')?.value,
                            year: document.getElementById('propertyB-year')?.value
                        };
                        data.propertyC = {
                            price: document.getElementById('propertyC-price')?.value,
                            sqft: document.getElementById('propertyC-sqft')?.value,
                            bedrooms: document.getElementById('propertyC-bedrooms')?.value,
                            bathrooms: document.getElementById('propertyC-bathrooms')?.value,
                            hoa: document.getElementById('propertyC-hoa')?.value,
                            year: document.getElementById('propertyC-year')?.value
                        };
                        break;
                }
                
                return data;
            }

            function populateFormFromData(data) {
                // Populate form fields based on saved data
                switch(data.type) {
                    case 'mortgage':
                        if (data.propertyPrice) document.getElementById('property-price').value = data.propertyPrice;
                        if (data.downPayment) document.getElementById('down-payment-slider').value = data.downPayment;
                        if (data.loanTerm) document.getElementById('loan-term').value = data.loanTerm;
                        if (data.interestRate) document.getElementById('interest-rate-slider').value = data.interestRate;
                        if (data.propertyTax) document.getElementById('property-tax').value = data.propertyTax;
                        if (data.homeInsurance) document.getElementById('home-insurance').value = data.homeInsurance;
                        if (data.hoa) document.getElementById('hoa').value = data.hoa;
                        break;
                }
                
                // Update slider displays and recalculate
                updateSliderDisplays();
                setTimeout(() => {
                    calculateMortgage();
                    calculateInvestment();
                    calculateCashFlow();
                }, 100);
            }

            function updateSliderDisplays() {
                const sliders = document.querySelectorAll('input[type="range"]');
                sliders.forEach(slider => {
                    const display = document.getElementById(slider.id.replace('-slider', '-value'));
                    if (display) {
                        display.textContent = slider.value + (slider.id.includes('rate') || slider.id.includes('percent') ? '%' : '');
                    }
                });
            }

            // PWA functionality - simplified without install prompt
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    // Register service worker for PWA functionality
                    const swCode = `
                        const CACHE_NAME = 'housemath-v1';
                        const urlsToCache = [
                            '/',
                            '/index.html'
                        ];
                        
                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(urlsToCache))
                            );
                        });
                        
                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => {
                                        return response || fetch(event.request);
                                    }
                                )
                            );
                        });
                    `;
                    
                    const swBlob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(swBlob);
                    
                    navigator.serviceWorker.register(swUrl)
                        .then(() => {
                            // Service worker registered successfully
                        })
                        .catch(() => {
                            // Service worker registration failed
                        });
                });
            }

            // Show saved calculations modal
            function showSavedCalculations() {
                try {
                    const savedCalcs = JSON.parse(localStorage.getItem('savedCalculations') || '{}');
                    const calcNames = Object.keys(savedCalcs);
                    
                    if (calcNames.length === 0) {
                        alert('üìÅ No saved calculations found');
                        return;
                    }
                    
                    // Create modal
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.5);
                        z-index: 10000;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        backdrop-filter: blur(5px);
                    `;
                    
                    const modalContent = document.createElement('div');
                    modalContent.style.cssText = `
                        background: var(--card-bg);
                        border-radius: 12px;
                        padding: 30px;
                        max-width: 500px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                        color: var(--text-color);
                        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
                    `;
                    
                    let modalHTML = `
                        <h2 style="margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-folder-open"></i> Saved Calculations
                        </h2>
                        <div style="margin-bottom: 20px;">
                    `;
                    
                    calcNames.forEach(name => {
                        const calc = savedCalcs[name];
                        const date = new Date(calc.savedAt).toLocaleString();
                        modalHTML += `
                            <div style="padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s ease;" 
                                 class="saved-calc-item" data-name="${name}">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 500; margin-bottom: 5px;">${name}</div>
                                        <div style="font-size: 0.875rem; color: #6b7280;">${calc.type} ‚Ä¢ ${date}</div>
                                    </div>
                                    <div>
                                        <button class="load-calc-btn" data-name="${name}" style="padding: 6px 12px; background: var(--primary-color); color: white; border: none; border-radius: 4px; margin-right: 5px; cursor: pointer;">Load</button>
                                        <button class="delete-calc-btn" data-name="${name}" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    modalHTML += `
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 10px;">
                            <button id="close-calc-modal" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">Close</button>
                        </div>
                    `;
                    
                    modalContent.innerHTML = modalHTML;
                    modal.appendChild(modalContent);
                    document.body.appendChild(modal);
                    
                    // Add event listeners
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                    
                    document.getElementById('close-calc-modal').addEventListener('click', () => {
                        modal.remove();
                    });
                    
                    document.querySelectorAll('.load-calc-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const name = e.target.dataset.name;
                            if (loadCalculation(name)) {
                                modal.remove();
                            }
                        });
                    });
                    
                    document.querySelectorAll('.delete-calc-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const name = e.target.dataset.name;
                            if (confirm(`Delete calculation "${name}"?`)) {
                                try {
                                    const savedCalcs = JSON.parse(localStorage.getItem('savedCalculations') || '{}');
                                    delete savedCalcs[name];
                                    localStorage.setItem('savedCalculations', JSON.stringify(savedCalcs));
                                    modal.remove();
                                    // Refresh the modal to show updated list
                                    showSavedCalculations();
                                } catch (e) {
                                    alert('‚ùå Failed to delete calculation');
                                }
                            }
                        });
                    });
                    
                    // Hover effects
                    document.querySelectorAll('.saved-calc-item').forEach(item => {
                        item.addEventListener('mouseenter', () => {
                            item.style.background = 'rgba(37, 99, 235, 0.1)';
                            item.style.borderColor = 'var(--primary-color)';
                        });
                        item.addEventListener('mouseleave', () => {
                            item.style.background = 'transparent';
                            item.style.borderColor = 'var(--border-color)';
                        });
                    });
                    
                } catch (e) {
                    alert('‚ùå Failed to load saved calculations');
                }
            }

            // Add haptic feedback for mobile
            function hapticFeedback(type = 'light') {
                if (navigator.vibrate) {
                    switch(type) {
                        case 'light': navigator.vibrate(10); break;
                        case 'medium': navigator.vibrate(20); break;
                        case 'heavy': navigator.vibrate([10, 10, 10]); break;
                    }
                }
            }

            // Enhanced mobile interactions
            document.addEventListener('touchstart', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    hapticFeedback('light');
                }
            });

            // Add loading states for better UX
            function showLoadingState(element, text = 'Calculating...') {
                if (element) {
                    element.disabled = true;
                    element.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`;
                }
            }

            function hideLoadingState(element, originalText) {
                if (element) {
                    element.disabled = false;
                    element.innerHTML = originalText;
                }
            }

            // Add input validation and formatting
            function formatCurrency(input) {
                let value = input.value.replace(/[^\d.]/g, '');
                if (value) {
                    const numValue = parseFloat(value);
                    if (!isNaN(numValue)) {
                        input.value = numValue.toLocaleString();
                    }
                }
            }

            function validateNumberInput(input, min = 0, max = Infinity) {
                const value = parseFloat(input.value.replace(/[^\d.]/g, ''));
                if (isNaN(value) || value < min || value > max) {
                    input.style.borderColor = '#ef4444';
                    return false;
                } else {
                    input.style.borderColor = '';
                    return true;
                }
            }

            // Add real-time input validation
            function setupInputValidation() {
                const numberInputs = document.querySelectorAll('input[type="number"]');
                
                numberInputs.forEach(input => {
                    // Add blur event for formatting
                    input.addEventListener('blur', () => {
                        if (input.id.includes('price') || input.id.includes('amount') || input.id.includes('income') || input.id.includes('payment')) {
                            const value = parseFloat(input.value.replace(/[^\d.]/g, ''));
                            if (!isNaN(value)) {
                                // Format as currency for display
                                input.dataset.rawValue = value;
                            }
                        }
                        
                        // Validate input
                        const isValid = validateNumberInput(input);
                    });
                    
                    // Add focus event to show raw value
                    input.addEventListener('focus', () => {
                        if (input.dataset.rawValue) {
                            input.value = input.dataset.rawValue;
                        }
                    });
                    
                    // Add input event for real-time feedback
                    input.addEventListener('input', () => {
                        input.style.borderColor = '';
                    });
                });
            }



            // Performance optimization: Debounce calculations
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // Auto-save functionality
            function setupAutoSave() {
                const autoSaveCalc = debounce(() => {
                    const currentTab = document.querySelector('.tab.active')?.dataset.tab;
                    if (currentTab) {
                        const data = extractCurrentCalculationData(currentTab);
                        try {
                            localStorage.setItem('autoSave_' + currentTab, JSON.stringify({
                                ...data,
                                autoSavedAt: new Date().toISOString()
                            }));
                        } catch (e) {
                            // localStorage not available
                        }
                    }
                }, 2000);

                // Auto-save on input changes
                document.addEventListener('input', autoSaveCalc);
                document.addEventListener('change', autoSaveCalc);
            }

            // Load auto-saved data on page load
            function loadAutoSavedData() {
                try {
                    const currentTab = document.querySelector('.tab.active')?.dataset.tab;
                    if (currentTab) {
                        const autoSaved = localStorage.getItem('autoSave_' + currentTab);
                        if (autoSaved) {
                            const data = JSON.parse(autoSaved);
                            const savedTime = new Date(data.autoSavedAt);
                            const now = new Date();
                            
                            // Only restore if saved within last 24 hours
                            if (now - savedTime < 24 * 60 * 60 * 1000) {
                                populateFormFromData(data);
                            }
                        }
                    }
                } catch (e) {
                    // Ignore errors
                }
            }

            // Add accessibility and mobile styles
            const style = document.createElement('style');
            style.textContent = `
                /* Enhanced focus styles for accessibility */
                button:focus-visible, input:focus-visible, select:focus-visible {
                    outline: 3px solid #3b82f6;
                    outline-offset: 2px;
                }
                
                /* Improved touch targets */
                @media (max-width: 768px) {
                    .tab, button, input[type="range"] {
                        min-height: 44px;
                        min-width: 44px;
                    }
                }
            `;
            document.head.appendChild(style);

            // Mobile menu variables will be initialized later in the DOM loading

            // DOM Elements
            const themeToggle = document.getElementById('theme-toggle');
            const tabs = document.querySelectorAll('.tab');
            
            // Try to use theme preference, with fallback if localStorage is unavailable
            let currentTheme = 'dark';
            try {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light') {
                    document.body.classList.remove('dark');
                    currentTheme = 'light';
                }
            } catch (e) {
                // localStorage not available - just use the default theme
            }
            
            // More robust check for restricted environment
            const isRestricted = (() => {
                try {
                    // Test localStorage access
                    window.localStorage;
                    
                    // Also test cross-origin restrictions
                    try {
                        // Attempt to access parent document - will fail in restricted environments
                        if (window.parent && window.parent !== window) {
                            window.parent.document;
                        }
                        return false;
                    } catch (e) {
                        // Cross-origin restriction detected
                        return true;
                    }
                } catch (e) {
                    // localStorage restriction detected
                    return true;
                }
            })();

            // Add warning about export if in restricted environment
            if (isRestricted) {

            }
            
            // Initialize charts and calculator values
            initializeCharts();
            calculateMortgage();
            calculateInvestment();
            calculateCashFlow();
            calculateClosing();
            calculateBuyer();
            calculateCommission();
            calculateComparison();
            
            // Theme toggle functionality
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark');
                const isDark = document.body.classList.contains('dark');
                currentTheme = isDark ? 'dark' : 'light';
                
                // Try to save to localStorage if available
                try {
                    localStorage.setItem('theme', currentTheme);
                } catch (e) {
                    // localStorage not available - just continue
                }
                
                reinitializeCharts();
            });

            // Save/Load button event handlers
            document.getElementById('save-calc').addEventListener('click', () => {
                hapticFeedback('light');
                const name = prompt('Save calculation as:', 'My Calculation ' + new Date().toLocaleDateString());
                if (name) {
                    const currentTab = document.querySelector('.tab.active')?.dataset.tab;
                    if (currentTab) {
                        const data = extractCurrentCalculationData(currentTab);
                        saveCalculation(name, data);
                        hapticFeedback('medium');
                    }
                }
            });

            document.getElementById('load-calc').addEventListener('click', () => {
                hapticFeedback('light');
                showSavedCalculations();
            });



            // Add some Billie-specific impressive features
            function addBillieSpecialFeatures() {
                // Secret click combo for Billie: Click title 5 times quickly
                let clickCount = 0;
                let clickTimer = null;
                
                const appTitle = document.getElementById('app-title');
                if (appTitle) {
                    appTitle.addEventListener('click', () => {
                        clickCount++;
                        
                        // Reset counter after 3 seconds of no clicks
                        if (clickTimer) {
                            clearTimeout(clickTimer);
                        }
                        
                        clickTimer = setTimeout(() => {
                            clickCount = 0;
                        }, 3000);
                        
                        // Trigger Billie mode after 5 clicks
                        if (clickCount === 5) {
                            triggerBillieMode();
                            clickCount = 0;
                            if (clickTimer) {
                                clearTimeout(clickTimer);
                            }
                        }
                    });
                }
                
                // Smart commission rate suggestions based on property value
                const commissionField = document.getElementById('commission-rate-slider');
                if (commissionField) {
                    commissionField.addEventListener('input', () => {
                        const salePrice = parseFloat(document.getElementById('sale-price')?.value || 0);
                        if (salePrice > 0) {
                            let optimalRate = 6.0; // Default rate
                            if (salePrice > 500000) optimalRate = 5.5;
                            else if (salePrice < 300000) optimalRate = 6.5;
                            
                            // Show suggestion if significantly different
                            const currentRate = parseFloat(commissionField.value);
                            if (Math.abs(currentRate - optimalRate) > 0.5) {
                                // Could add a gentle suggestion tooltip here if needed
                            }
                        }
                    });
                }
            }

            function triggerBillieMode() {
                // Special mode just for Billie!
                const billieMessages = [
                    "üè† Billie! My interest rate in taking you out is at an all-time high! - Matthew :)  üíò",
        
                ];
                
                const randomMessage = billieMessages[Math.floor(Math.random() * billieMessages.length)];
                
                // Add some sparkle effects
                const sparkles = document.createElement('div');
                sparkles.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 9999;
                `;
                
                for (let i = 0; i < 20; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.textContent = '‚ú®';
                    sparkle.style.cssText = `
                        position: absolute;
                        font-size: 24px;
                        animation: sparkle 3s ease-out forwards;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                    `;
                    sparkles.appendChild(sparkle);
                }
                
                const sparkleStyle = document.createElement('style');
                sparkleStyle.textContent = `
                    @keyframes sparkle {
                        0% { transform: scale(0) rotate(0deg); opacity: 1; }
                        50% { transform: scale(1) rotate(180deg); opacity: 1; }
                        100% { transform: scale(0) rotate(360deg); opacity: 0; }
                    }
                `;
                document.head.appendChild(sparkleStyle);
                document.body.appendChild(sparkles);
                
                setTimeout(() => {
                    sparkles.remove();
                    sparkleStyle.remove();
                }, 3000);
                
                // Show the message to Billie in a fun popup
                showBilliePopup(randomMessage);
                hapticFeedback('heavy');
                
                // Temporarily change the theme to something special
                document.body.style.background = 'var(--accent-color)';
                setTimeout(() => {
                    document.body.style.background = '';
                }, 5000);
            }

            function showBilliePopup(message) {
                // Create the popup overlay
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    backdrop-filter: blur(10px);
                    z-index: 15000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    animation: fadeIn 0.3s ease;
                `;

                // Create the popup content
                const popup = document.createElement('div');
                popup.style.cssText = `
                    background: linear-gradient(135deg, #3b82f6, #60a5fa);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    box-shadow: 0 20px 40px rgba(255, 107, 107, 0.3);
                    border: 3px solid rgba(255, 255, 255, 0.3);
                    position: relative;
                    animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                    color: white;
                    font-family: 'Poppins', sans-serif;
                `;

                // Add floating hearts
                const heartsContainer = document.createElement('div');
                heartsContainer.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    overflow: hidden;
                    border-radius: 20px;
                `;

                for (let i = 0; i < 15; i++) {
                    const heart = document.createElement('div');
                    heart.textContent = 'üíñ';
                    heart.style.cssText = `
                        position: absolute;
                        font-size: ${Math.random() * 20 + 15}px;
                        animation: floatHearts ${Math.random() * 3 + 2}s ease-in-out infinite;
                        animation-delay: ${Math.random() * 2}s;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        opacity: 0.7;
                    `;
                    heartsContainer.appendChild(heart);
                }

                popup.appendChild(heartsContainer);

                // Add the message
                const messageElement = document.createElement('div');
                messageElement.style.cssText = `
                    font-size: 1.5rem;
                    font-weight: 600;
                    margin-bottom: 20px;
                    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                    line-height: 1.4;
                    position: relative;
                    z-index: 1;
                `;
                messageElement.textContent = message;
                popup.appendChild(messageElement);

                // Add tap instruction
                const tapInstruction = document.createElement('div');
                tapInstruction.style.cssText = `
                    font-size: 1rem;
                    opacity: 0.9;
                    margin-top: 20px;
                    animation: pulse 2s infinite;
                    position: relative;
                    z-index: 1;
                `;
                tapInstruction.textContent = 'üíï Tap anywhere to close üíï';
                popup.appendChild(tapInstruction);

                overlay.appendChild(popup);

                // Add animations
                const animationStyles = document.createElement('style');
                animationStyles.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes popIn {
                        0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                        50% { transform: scale(1.1) rotate(5deg); }
                        100% { transform: scale(1) rotate(0deg); opacity: 1; }
                    }
                    @keyframes floatHearts {
                        0%, 100% { transform: translateY(0px) rotate(0deg); }
                        25% { transform: translateY(-10px) rotate(5deg); }
                        50% { transform: translateY(-20px) rotate(-5deg); }
                        75% { transform: translateY(-5px) rotate(3deg); }
                    }
                    @keyframes pulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                    }
                `;
                document.head.appendChild(animationStyles);

                // Add to page
                document.body.appendChild(overlay);

                // Close when clicked/tapped
                overlay.addEventListener('click', () => {
                    overlay.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        overlay.remove();
                        animationStyles.remove();
                    }, 300);
                });

                // Add fadeOut animation
                const fadeOutStyle = document.createElement('style');
                fadeOutStyle.textContent = `
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(fadeOutStyle);

                // Prevent scrolling while popup is open
                document.body.style.overflow = 'hidden';
                
                // Restore scrolling when popup closes
                overlay.addEventListener('click', () => {
                    setTimeout(() => {
                        document.body.style.overflow = '';
                    }, 300);
                });
            }

            // Initialize special features
            addBillieSpecialFeatures();
            
            // Tab switching functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs (both desktop and mobile)
                    tabs.forEach(t => t.classList.remove('active'));
                    const mobileTabs = document.querySelectorAll('.mobile-tab');
                    mobileTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Also update mobile tab
                    const tabId = tab.getAttribute('data-tab');
                    const matchingMobileTab = document.querySelector(`.mobile-tab[data-tab="${tabId}"]`);
                    if (matchingMobileTab) {
                        matchingMobileTab.classList.add('active');
                    }
                    
                    // Hide all calculators
                    const calculators = ['mortgage', 'investment', 'cashflow', 'closing', 'buyer', 'commission', 'comparison', 'report'];
                    calculators.forEach(calc => {
                        const element = document.getElementById(`${calc}-calculator`);
                        if (element) element.classList.add('hidden');
                    });
                    
                    // Show the selected calculator
                    const selectedCalculator = document.getElementById(`${tabId}-calculator`);
                    if (selectedCalculator) {
                        selectedCalculator.classList.remove('hidden');
                    }
                });
            });

            // Set first tab as active by default
            if (tabs.length > 0) {
                tabs[0].classList.add('active');
            }
            
            // Slider value displays
            const sliders = [
                { slider: 'down-payment-slider', display: 'down-payment-value', suffix: '%' },
                { slider: 'interest-rate-slider', display: 'interest-rate-value', suffix: '%' },
                { slider: 'expenses-slider', display: 'expenses-value', suffix: '%' },
                { slider: 'vacancy-slider', display: 'vacancy-value', suffix: '%' },
                { slider: 'appreciation-slider', display: 'appreciation-value', suffix: '%' },
                { slider: 'management-slider', display: 'management-value', suffix: '%' },
                { slider: 'maintenance-slider', display: 'maintenance-value', suffix: '%' },
                { slider: 'vacancy-slider', display: 'vacancy-value', suffix: '%' },
                { slider: 'commission-rate-slider', display: 'commission-rate-display', suffix: '%' },
                { slider: 'listing-split-slider', display: 'listing-split-display', suffix: '%' },
                { slider: 'selling-split-slider', display: 'selling-split-display', suffix: '%' }
            ];
            
            sliders.forEach(item => {
                const slider = document.getElementById(item.slider);
                const display = document.getElementById(item.display);
                
                if (slider && display) {
                    // Set initial value
                    display.textContent = slider.value + item.suffix;
                    
                    // Update value on slider change
                    slider.addEventListener('input', () => {
                        display.textContent = slider.value + item.suffix;
                    });
                }
            });
            
            // Calculator button event listeners
            document.getElementById('calculate-mortgage').addEventListener('click', calculateMortgage);
            document.getElementById('calculate-investment').addEventListener('click', calculateInvestment);
            document.getElementById('calculate-cashflow').addEventListener('click', calculateCashFlow);
            document.getElementById('calculate-closing').addEventListener('click', calculateClosing);
            document.getElementById('calculate-buyer').addEventListener('click', calculateBuyer);
            document.getElementById('calculate-commission').addEventListener('click', calculateCommission);
            document.getElementById('calculate-comparison').addEventListener('click', calculateComparison);
            

            
            // Initialize charts
            function initializeCharts() {
                // Theme-aware colors
                const isDark = document.body.classList.contains('dark');
                const textColor = isDark ? '#f9fafb' : '#1f2937';
                const gridColor = isDark ? '#374151' : '#e5e7eb';
                
                // Default options for line/bar charts
                const defaultOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: textColor
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    }
                };
                
                // Default options for pie/doughnut charts
                const pieOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: textColor
                            }
                        }
                    }
                };
                
                // Payment Breakdown Chart
                const paymentCtx = document.getElementById('payment-chart').getContext('2d');
                paymentChart = new Chart(paymentCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Principal & Interest', 'Property Tax', 'Insurance', 'HOA'],
                        datasets: [{
                            data: [1425, 292, 100, 0],
                            backgroundColor: ['#3b82f6', '#7c3aed', '#ec4899', '#10b981']
                        }]
                    },
                    options: pieOptions
                });
                
                // Amortization Chart
                const amortizationCtx = document.getElementById('amortization-chart').getContext('2d');
                amortizationChart = new Chart(amortizationCtx, {
                    type: 'line',
                    data: {
                        labels: ['Year 5', 'Year 10', 'Year 15', 'Year 20', 'Year 25', 'Year 30'],
                        datasets: [
                            {
                                label: 'Principal',
                                data: [38000, 83000, 138000, 204000, 280000],
                                borderColor: '#3b82f6',
                                backgroundColor: '#3b82f6',
                                tension: 0.1
                            },
                            {
                                label: 'Interest',
                                data: [62000, 105000, 137000, 156000, 0],
                                borderColor: '#7c3aed',
                                backgroundColor: '#7c3aed',
                                tension: 0.1
                            }
                        ]
                    },
                    options: defaultOptions
                });
                
                // Investment Chart
                const investmentCtx = document.getElementById('investment-chart').getContext('2d');
                investmentChart = new Chart(investmentCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Year 0', 'Year 2', 'Year 4', 'Year 6', 'Year 8', 'Year 10'],
                        datasets: [
                            {
                                label: 'Property Value',
                                data: [300000, 321368, 344257, 368777, 395043, 423180],
                                backgroundColor: '#3b82f6'
                            },
                            {
                                label: 'Cumulative Cash Flow',
                                data: [0, 31824, 66211, 103288, 143195, 186095],
                                backgroundColor: '#10b981'
                            }
                        ]
                    },
                    options: defaultOptions
                });
                
                // Commission Chart
                const commissionCtx = document.getElementById('commission-chart').getContext('2d');
                commissionChart = new Chart(commissionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Your Net Commission', 'Brokerage Fees', 'Other Agent Commission'],
                        datasets: [{
                            data: [18505, 395, 8100],
                            backgroundColor: ['#10b981', '#f59e0b', '#6b7280']
                        }]
                    },
                    options: pieOptions
                });
                
                // Property Comparison Chart
                const comparisonCtx = document.getElementById('comparison-chart').getContext('2d');
                comparisonChart = new Chart(comparisonCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Property A', 'Property B', 'Property C'],
                        datasets: [
                            {
                                label: 'Price ($)',
                                data: [425000, 395000, 475000],
                                backgroundColor: '#3b82f6',
                                yAxisID: 'y'
                            },
                            {
                                label: 'Price per Sq Ft ($)',
                                data: [202, 203, 207],
                                backgroundColor: '#10b981',
                                type: 'line',
                                borderColor: '#10b981',
                                borderWidth: 3,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: textColor
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor,
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                },
                                ticks: {
                                    color: textColor,
                                    callback: function(value) {
                                        return '$' + value + '/sqft';
                                    }
                                }
                            }
                        }
                    }
                });

                // Cash Flow Chart (Expense Breakdown)
                const cashflowCtx = document.getElementById('cashflow-chart').getContext('2d');
                expenseChart = new Chart(cashflowCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Net Cash Flow', 'Mortgage Payment', 'Property Tax', 'Insurance', 'Management', 'Maintenance', 'Vacancy Reserve'],
                        datasets: [{
                            data: [650, 1000, 150, 100, 200, 100, 100],
                            backgroundColor: ['#10b981', '#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6', '#ec4899', '#6b7280']
                        }]
                    },
                    options: pieOptions
                });

                // Closing Costs Chart
                const closingCtx = document.getElementById('closing-chart').getContext('2d');
                closingChart = new Chart(closingCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Title Insurance', 'Attorney Fees', 'Recording Fees', 'Transfer Tax', 'Inspection', 'Survey', 'Other'],
                        datasets: [{
                            label: 'Costs ($)',
                            data: [1200, 800, 150, 2100, 400, 300, 500],
                            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#6b7280']
                        }]
                    },
                    options: defaultOptions
                });
            }
            
            // Reinitialize charts when theme changes
            function reinitializeCharts() {
                // Destroy existing charts
                if (paymentChart) paymentChart.destroy();
                if (amortizationChart) amortizationChart.destroy();
                if (investmentChart) investmentChart.destroy();
                if (expenseChart) expenseChart.destroy();
                if (commissionChart) commissionChart.destroy();
                if (comparisonChart) comparisonChart.destroy();
                if (closingChart) closingChart.destroy();
                
                // Initialize new charts
                initializeCharts();
                
                // Update charts with current data
                calculateMortgage();
                calculateInvestment();
                calculateCashFlow();
                calculateClosing();
                calculateBuyer();
                calculateCommission();
            }
            
            // Calculate mortgage
            function calculateMortgage() {
                try {
                    // Get input values with validation
                    const propertyPrice = parseFloat(document.getElementById('property-price').value) || 0;
                    const downPaymentPercent = parseFloat(document.getElementById('down-payment-slider').value) || 0;
                    const loanTerm = parseInt(document.getElementById('loan-term').value) || 30;
                    const interestRate = parseFloat(document.getElementById('interest-rate-slider').value) || 0;
                    const propertyTax = parseFloat(document.getElementById('property-tax').value) || 0;
                    const homeInsurance = parseFloat(document.getElementById('home-insurance').value) || 0;
                    const hoa = parseFloat(document.getElementById('hoa').value) || 0;
                    
                    // Validate inputs
                    if (propertyPrice <= 0 || interestRate < 0 || downPaymentPercent < 0 || downPaymentPercent > 100) {
                        return;
                    }
                
                // Calculate loan details
                const downPayment = propertyPrice * (downPaymentPercent / 100);
                const loanAmount = propertyPrice - downPayment;
                const monthlyInterestRate = interestRate / 100 / 12;
                const numberOfPayments = loanTerm * 12;
                
                // Calculate monthly principal and interest payment
                const monthlyPayment = loanAmount * monthlyInterestRate * Math.pow(1 + monthlyInterestRate, numberOfPayments) / 
                    (Math.pow(1 + monthlyInterestRate, numberOfPayments) - 1);
                
                // Calculate total payment with taxes and insurance
                const monthlyPropertyTax = propertyTax / 12;
                const monthlyInsurance = homeInsurance / 12;
                const totalMonthlyPayment = monthlyPayment + monthlyPropertyTax + monthlyInsurance + hoa;
                
                // Calculate total interest over life of loan
                const totalInterest = (monthlyPayment * numberOfPayments) - loanAmount;
                
                // Update DOM elements
                document.getElementById('principal-interest').textContent = '$' + Math.round(monthlyPayment).toLocaleString();
                document.getElementById('total-monthly').textContent = '$' + Math.round(totalMonthlyPayment).toLocaleString();
                document.getElementById('loan-amount').textContent = '$' + Math.round(loanAmount).toLocaleString();
                document.getElementById('down-payment-amount').textContent = '$' + Math.round(downPayment).toLocaleString();
                document.getElementById('total-interest').textContent = '$' + Math.round(totalInterest).toLocaleString();
                document.getElementById('total-cost').textContent = '$' + Math.round(propertyPrice + totalInterest).toLocaleString();
                
                // Update payment breakdown chart
                if (paymentChart) {
                    paymentChart.data.datasets[0].data = [
                        Math.round(monthlyPayment), 
                        Math.round(monthlyPropertyTax), 
                        Math.round(monthlyInsurance), 
                        Math.round(hoa)
                    ];
                    paymentChart.update();
                }
                
                // Update amortization chart
                if (amortizationChart) {
                    // Calculate amortization schedule for key years
                    const years = loanTerm > 15 ? [5, 10, 15, 20, 25, 30].filter(y => y <= loanTerm) : [Math.round(loanTerm/3), Math.round(2*loanTerm/3), loanTerm];
                    const principalPaid = [];
                    const interestPaid = [];
                    
                    years.forEach(year => {
                        const monthsPaid = year * 12;
                        let remainingBalance = loanAmount;
                        let totalInterestPaid = 0;
                        
                        for (let i = 1; i <= monthsPaid; i++) {
                            const interestPayment = remainingBalance * monthlyInterestRate;
                            const principalPayment = monthlyPayment - interestPayment;
                            
                            remainingBalance -= principalPayment;
                            totalInterestPaid += interestPayment;
                        }
                        
                        principalPaid.push(Math.round(loanAmount - remainingBalance));
                        interestPaid.push(Math.round(totalInterestPaid));
                    });
                    
                    // Update chart data
                    amortizationChart.data.labels = years.map(year => `Year ${year}`);
                    amortizationChart.data.datasets[0].data = principalPaid;
                    amortizationChart.data.datasets[1].data = interestPaid;
                    amortizationChart.update();
                }
                } catch (error) {
                    // Handle calculation errors gracefully
                }
            }
            
            // Calculate investment returns
            function calculateInvestment() {
                try {
                    // Get input values with validation
                    const purchasePrice = parseFloat(document.getElementById('inv-purchase-price').value) || 0;
                    const annualRent = parseFloat(document.getElementById('annual-rent').value) || 0;
                    const expensesPercent = parseFloat(document.getElementById('expenses-slider').value) || 0;
                    const vacancyRate = parseFloat(document.getElementById('vacancy-slider').value) || 0;
                    const appreciationRate = parseFloat(document.getElementById('appreciation-slider').value) || 0;
                    const holdingPeriod = parseInt(document.getElementById('holding-period').value) || 10;
                    
                    // Validate inputs
                    if (purchasePrice <= 0 || annualRent < 0) {
                        return;
                    }
                
                // Calculate investment metrics
                const monthlyRent = annualRent / 12;
                const effectiveAnnualRent = annualRent * (1 - vacancyRate / 100);
                const annualExpenses = effectiveAnnualRent * (expensesPercent / 100);
                const annualCashFlow = effectiveAnnualRent - annualExpenses;
                const monthlyCashFlow = annualCashFlow / 12;
                
                // Assume 25% down payment for cash-on-cash ROI calculation
                const downPayment = purchasePrice * 0.25;
                const cashOnCashROI = (annualCashFlow / downPayment) * 100;
                
                // Cap rate calculation (NOI / Purchase Price)
                const netOperatingIncome = effectiveAnnualRent - annualExpenses;
                const capRate = (netOperatingIncome / purchasePrice) * 100;
                
                // Update DOM elements
                document.getElementById('monthly-rent').textContent = '$' + Math.round(monthlyRent).toLocaleString();
                document.getElementById('monthly-expenses').textContent = '$' + Math.round(annualExpenses / 12).toLocaleString();
                document.getElementById('monthly-cashflow').textContent = '$' + Math.round(monthlyCashFlow).toLocaleString();
                document.getElementById('annual-cashflow').textContent = '$' + Math.round(annualCashFlow).toLocaleString();
                document.getElementById('cash-on-cash').textContent = cashOnCashROI.toFixed(1) + '%';
                document.getElementById('cap-rate').textContent = capRate.toFixed(1) + '%';
                document.getElementById('period-label').textContent = holdingPeriod;
                
                // Future value calculations
                const futurePropertyValue = purchasePrice * Math.pow(1 + appreciationRate / 100, holdingPeriod);
                const totalRentalIncome = annualCashFlow * holdingPeriod;
                const totalReturn = (futurePropertyValue - purchasePrice) + totalRentalIncome;
                const annualizedReturn = (Math.pow(1 + totalReturn / downPayment, 1 / holdingPeriod) - 1) * 100;
                
                document.getElementById('future-property-value').textContent = '$' + Math.round(futurePropertyValue).toLocaleString();
                document.getElementById('total-rental-income').textContent = '$' + Math.round(totalRentalIncome).toLocaleString();
                document.getElementById('total-return').textContent = '$' + Math.round(totalReturn).toLocaleString();
                document.getElementById('annualized-return').textContent = annualizedReturn.toFixed(1) + '%';
                
                // Update investment chart
                if (investmentChart) {
                    // Select appropriate year markers based on holding period
                    const yearSpacing = Math.max(1, Math.round(holdingPeriod / 5));
                    const yearLabels = [];
                    const propertyValues = [];
                    const cashFlows = [];
                    
                    for (let year = 0; year <= holdingPeriod; year += yearSpacing) {
                        yearLabels.push(`Year ${year}`);
                        propertyValues.push(Math.round(purchasePrice * Math.pow(1 + appreciationRate / 100, year)));
                        cashFlows.push(Math.round(year === 0 ? 0 : annualCashFlow * year));
                    }
                    
                    // Make sure the final year is included
                    if (yearLabels[yearLabels.length - 1] !== `Year ${holdingPeriod}`) {
                        yearLabels.push(`Year ${holdingPeriod}`);
                        propertyValues.push(Math.round(futurePropertyValue));
                        cashFlows.push(Math.round(totalRentalIncome));
                    }
                    
                    // Update chart data
                    investmentChart.data.labels = yearLabels;
                    investmentChart.data.datasets[0].data = propertyValues;
                    investmentChart.data.datasets[1].data = cashFlows;
                    investmentChart.update();
                }
                } catch (error) {
                    // Handle calculation errors gracefully
                }
            }
            
            // Calculate rental cash flow
            function calculateCashFlow() {
                // Get input values
                const rentalIncome = parseFloat(document.getElementById('rental-income').value);
                const mortgagePayment = parseFloat(document.getElementById('mortgage-payment').value);
                const propertyTax = parseFloat(document.getElementById('rental-property-tax').value);
                const insurance = parseFloat(document.getElementById('rental-insurance').value);
                const managementPercent = parseFloat(document.getElementById('management-slider').value);
                const maintenancePercent = parseFloat(document.getElementById('maintenance-slider').value);
                const vacancyPercent = parseFloat(document.getElementById('vacancy-slider').value);
                
                // Calculate monthly expenses
                const effectiveRentalIncome = rentalIncome * (1 - vacancyPercent / 100);
                const managementFee = effectiveRentalIncome * (managementPercent / 100);
                const maintenanceReserve = effectiveRentalIncome * (maintenancePercent / 100);
                const vacancyReserve = rentalIncome * (vacancyPercent / 100);
                
                const totalExpenses = mortgagePayment + propertyTax + insurance + managementFee + maintenanceReserve;
                const netCashFlow = effectiveRentalIncome - totalExpenses;
                const grossIncome = rentalIncome;
                const netOperatingIncome = effectiveRentalIncome - (propertyTax + insurance + managementFee + maintenanceReserve);
                const cashFlowAfterDebt = netOperatingIncome - mortgagePayment;
                
                // Update DOM elements
                document.getElementById('gross-income').textContent = '$' + Math.round(grossIncome).toLocaleString();
                document.getElementById('total-expenses').textContent = '$' + Math.round(totalExpenses).toLocaleString();
                document.getElementById('net-operating-income').textContent = '$' + Math.round(netOperatingIncome).toLocaleString();
                document.getElementById('cash-flow-before-taxes').textContent = '$' + Math.round(cashFlowAfterDebt).toLocaleString();
                document.getElementById('cash-flow-after-taxes').textContent = '$' + Math.round(cashFlowAfterDebt).toLocaleString(); // Same for now
                
                // Update expense breakdown chart
                if (expenseChart) {
                    expenseChart.data.datasets[0].data = [
                        Math.round(Math.max(netCashFlow, 0)),
                        Math.round(mortgagePayment),
                        Math.round(propertyTax),
                        Math.round(insurance),
                        Math.round(managementFee),
                        Math.round(maintenanceReserve),
                        Math.round(vacancyReserve)
                    ];
                    expenseChart.update();
                }
            }

            // Calculate closing costs
            function calculateClosing() {
                // Get input values
                const salesPrice = parseFloat(document.getElementById('closing-price').value);
                const mortgageAmount = parseFloat(document.getElementById('closing-mortgage').value);
                const commissionRate = parseFloat(document.getElementById('commission-rate').value);
                const deedPages = parseInt(document.getElementById('deed-pages').value);
                const mortgagePages = parseInt(document.getElementById('mortgage-pages').value);
                
                // Calculate standard closing costs
                const titleInsurance = Math.round(salesPrice * 0.003); // ~0.3% of sales price
                const attorneyFees = 800;
                const recordingDeed = deedPages * 25; // $25 per page
                const recordingMortgage = mortgagePages * 25; // $25 per page
                const transferTax = Math.round(salesPrice * 0.006); // ~0.6% transfer tax
                const inspection = 400;
                const survey = 300;
                const lenderFees = Math.round(mortgageAmount * 0.01); // 1% of loan amount
                const appraisal = 500;
                const creditReport = 75;
                const realEstateCommission = Math.round(salesPrice * (commissionRate / 100));
                
                // Calculate totals
                const totalRecordingFees = recordingDeed + recordingMortgage;
                const totalLenderFees = lenderFees + appraisal + creditReport;
                const otherFees = inspection + survey + attorneyFees;
                const totalClosingCosts = titleInsurance + totalRecordingFees + transferTax + totalLenderFees + otherFees + realEstateCommission;
                
                // Update DOM elements that actually exist in the HTML
                document.getElementById('buyer-total').textContent = '$' + totalClosingCosts.toLocaleString();
                document.getElementById('seller-total').textContent = '$' + realEstateCommission.toLocaleString();
                document.getElementById('mortgage-fees').textContent = '$' + totalLenderFees.toLocaleString();
                document.getElementById('settlement-fee').textContent = '$' + attorneyFees.toLocaleString();
                document.getElementById('title-search').textContent = '$' + Math.round(titleInsurance/2).toLocaleString();
                document.getElementById('association-fee').textContent = '$250';
                document.getElementById('survey').textContent = '$' + survey.toLocaleString();
                document.getElementById('termite').textContent = '$' + inspection.toLocaleString();
                document.getElementById('lien-search').textContent = '$75';
                document.getElementById('commission').textContent = '$' + realEstateCommission.toLocaleString();
                document.getElementById('owners-policy').textContent = '$' + Math.round(titleInsurance/2).toLocaleString();
                document.getElementById('lenders-policy').textContent = '$' + Math.round(titleInsurance/2).toLocaleString();
                document.getElementById('environmental').textContent = '$100';
                document.getElementById('alta-9').textContent = '$50';
                document.getElementById('alta-5').textContent = '$25';
                document.getElementById('alta-4').textContent = '$25';
                document.getElementById('recording').textContent = '$' + totalRecordingFees.toLocaleString();
                document.getElementById('doc-stamp-mortgage').textContent = '$' + Math.round(transferTax/2).toLocaleString();
                document.getElementById('intangible-tax').textContent = '$' + Math.round(transferTax/3).toLocaleString();
                document.getElementById('doc-stamp-deed').textContent = '$' + Math.round(transferTax/2).toLocaleString();
                
                // Update closing costs chart
                if (closingChart) {
                    closingChart.data.datasets[0].data = [
                        titleInsurance,
                        attorneyFees,
                        totalRecordingFees,
                        transferTax,
                        inspection,
                        survey,
                        totalLenderFees
                    ];
                    closingChart.update();
                }
            }

            // Calculate buyer costs
            function calculateBuyer() {
                // Get input values
                const salesPrice = parseFloat(document.getElementById('buyer-sales-price').value);
                const downPayment = parseFloat(document.getElementById('buyer-down-payment').value);
                const mortgageAmount = parseFloat(document.getElementById('buyer-mortgage').value);
                const mortgageRate = parseFloat(document.getElementById('buyer-mortgage-rate').value);
                const points = parseFloat(document.getElementById('buyer-points').value);
                const daysInterest = parseInt(document.getElementById('buyer-days-interest').value);
                
                // Calculate buyer costs
                const pointsCost = mortgageAmount * (points / 100);
                const dailyInterest = (mortgageAmount * (mortgageRate / 100)) / 365;
                const prepaidInterest = dailyInterest * daysInterest;
                const otherCosts = 2500; // Estimated other closing costs
                const totalDue = downPayment + pointsCost + prepaidInterest + otherCosts;
                
                // Update DOM elements (using safe checks)
                const buyerTotalElement = document.getElementById('buyer-total-due');
                const pointsCostElement = document.getElementById('buyer-points-cost');
                const buyerMortgageElement = document.getElementById('buyer-mortgage');
                const buyerPointsElement = document.getElementById('buyer-points');
                const buyerInterestElement = document.getElementById('buyer-interest');
                const buyerOtherCostsElement = document.getElementById('buyer-other-costs');
                
                if (buyerTotalElement) buyerTotalElement.textContent = '$' + Math.round(totalDue).toLocaleString();
                if (pointsCostElement) pointsCostElement.textContent = '$' + Math.round(pointsCost).toLocaleString();
                if (buyerMortgageElement) buyerMortgageElement.textContent = '$' + Math.round(mortgageAmount).toLocaleString();
                if (buyerPointsElement) buyerPointsElement.textContent = '$' + Math.round(pointsCost).toLocaleString();
                if (buyerInterestElement) buyerInterestElement.textContent = '$' + Math.round(prepaidInterest).toLocaleString();
                if (buyerOtherCostsElement) buyerOtherCostsElement.textContent = '$' + Math.round(otherCosts).toLocaleString();
            }

            // Calculate commission
            function calculateCommission() {
                // Get input values
                const salePrice = parseFloat(document.getElementById('sale-price').value);
                const commissionRate = parseFloat(document.getElementById('commission-rate-slider').value);
                const listingSplit = parseFloat(document.getElementById('listing-split-slider').value);
                const sellingSplit = parseFloat(document.getElementById('selling-split-slider').value);
                const transactionFee = parseFloat(document.getElementById('transaction-fee').value);
                const agentRole = document.getElementById('agent-role').value;
                
                // Calculate commission breakdown
                const totalCommission = salePrice * (commissionRate / 100);
                const listingSide = totalCommission / 2;
                const sellingSide = totalCommission / 2;
                
                let yourGrossCommission = 0;
                if (agentRole === 'listing') {
                    yourGrossCommission = listingSide * (listingSplit / 100);
                } else if (agentRole === 'selling') {
                    yourGrossCommission = sellingSide * (sellingSplit / 100);
                } else if (agentRole === 'both') {
                    yourGrossCommission = (listingSide * (listingSplit / 100)) + (sellingSide * (sellingSplit / 100));
                }
                
                const yourNetCommission = yourGrossCommission - transactionFee;
                
                // Update DOM elements
                document.getElementById('total-commission').textContent = '$' + Math.round(totalCommission).toLocaleString();
                document.getElementById('listing-side-total').textContent = '$' + Math.round(listingSide).toLocaleString();
                document.getElementById('selling-side-total').textContent = '$' + Math.round(sellingSide).toLocaleString();
                document.getElementById('your-gross-commission').textContent = '$' + Math.round(yourGrossCommission).toLocaleString();
                document.getElementById('your-net-commission').textContent = '$' + Math.round(yourNetCommission).toLocaleString();
                document.getElementById('your-commission-before-fees').textContent = '$' + Math.round(yourGrossCommission).toLocaleString();
                document.getElementById('total-fees').textContent = '$' + Math.round(transactionFee).toLocaleString();
                document.getElementById('final-commission').textContent = '$' + Math.round(yourNetCommission).toLocaleString();
                
                // Update commission chart
                if (commissionChart) {
                    const brokerageFee = yourGrossCommission - yourNetCommission;
                    const otherAgentCommission = totalCommission - yourGrossCommission;
                    
                    commissionChart.data.datasets[0].data = [
                        Math.round(yourNetCommission),
                        Math.round(brokerageFee),
                        Math.round(otherAgentCommission)
                    ];
                    commissionChart.update();
                }
                
                // Celebrate big commissions!
                if (yourNetCommission > 15000) {
                    hapticFeedback('heavy');
                }
            }

            // Calculate property comparison
            function calculateComparison() {
                // Get property data
                const properties = ['A', 'B', 'C'].map(letter => ({
                    name: `Property ${letter}`,
                    price: parseFloat(document.getElementById(`property${letter}-price`).value),
                    sqft: parseFloat(document.getElementById(`property${letter}-sqft`).value),
                    bedrooms: parseFloat(document.getElementById(`property${letter}-bedrooms`).value),
                    bathrooms: parseFloat(document.getElementById(`property${letter}-bathrooms`).value),
                    hoa: parseFloat(document.getElementById(`property${letter}-hoa`).value),
                    year: parseFloat(document.getElementById(`property${letter}-year`).value)
                }));
                
                // Calculate price per square foot for each property
                properties.forEach((prop, index) => {
                    const letter = ['A', 'B', 'C'][index];
                    const pricePerSqft = prop.sqft > 0 ? prop.price / prop.sqft : 0;
                    prop.pricePerSqft = pricePerSqft;
                    document.getElementById(`property${letter}-price-per-sqft`).textContent = '$' + Math.round(pricePerSqft) + '/sqft';
                });
                
                // Find best values
                const bestPricePerSqft = properties.reduce((best, current) => 
                    current.pricePerSqft < best.pricePerSqft && current.pricePerSqft > 0 ? current : best
                );
                const mostBedrooms = properties.reduce((most, current) => 
                    current.bedrooms > most.bedrooms ? current : most
                );
                const newestProperty = properties.reduce((newest, current) => 
                    current.year > newest.year ? current : newest
                );
                const lowestHoa = properties.reduce((lowest, current) => 
                    current.hoa < lowest.hoa ? current : lowest
                );
                
                // Calculate overall recommendation (simple scoring system)
                properties.forEach(prop => {
                    let score = 0;
                    
                    // Lower price per sqft is better
                    if (prop === bestPricePerSqft) score += 30;
                    
                    // More bedrooms is better
                    if (prop === mostBedrooms) score += 20;
                    
                    // Newer is better
                    if (prop === newestProperty) score += 15;
                    
                    // Lower HOA is better
                    if (prop === lowestHoa) score += 10;
                    
                    // Size bonus (bigger is generally better)
                    if (prop.sqft > 2200) score += 10;
                    
                    prop.score = score;
                });
                
                const recommended = properties.reduce((best, current) => 
                    current.score > best.score ? current : best
                );
                
                // Update DOM elements
                document.getElementById('best-price-per-sqft').textContent = bestPricePerSqft.name;
                document.getElementById('most-bedrooms').textContent = `${mostBedrooms.name} (${mostBedrooms.bedrooms} bedrooms)`;
                document.getElementById('newest-property').textContent = `${newestProperty.name} (${newestProperty.year})`;
                document.getElementById('lowest-hoa').textContent = `${lowestHoa.name} ($${lowestHoa.hoa}/month)`;
                document.getElementById('recommended-choice').textContent = recommended.name;
                
                // Update comparison chart
                if (comparisonChart) {
                    comparisonChart.data.labels = properties.map(p => p.name);
                    comparisonChart.data.datasets[0].data = properties.map(p => p.price);
                    comparisonChart.data.datasets[1].data = properties.map(p => p.pricePerSqft);
                    comparisonChart.update();
                }
                
                // Analysis messages available in the results section
                const analysisMessages = [
                    `üìä ${bestPricePerSqft.name} offers the best value at $${Math.round(bestPricePerSqft.pricePerSqft)}/sqft`,
                    `üèÜ Based on all factors, ${recommended.name} appears to be the smartest choice`,
                    `üí° ${newestProperty.name} is the newest (${newestProperty.year}) but ${lowestHoa.name} has the lowest HOA fees`
                ];
            }

            // Modern Export System for Beautiful Reports
            class ExportManager {
                constructor() {
                    this.setupExportListeners();
                }

                setupExportListeners() {
                    // Add click listeners to all export options
                    document.addEventListener('click', (e) => {
                        if (e.target.classList.contains('export-option')) {
                            e.preventDefault();
                            const type = e.target.dataset.type;
                            const content = e.target.dataset.content;
                            const source = e.target.dataset.source;
                            
                            if (type === 'pdf') {
                                this.exportToPDF(source, content);
                            } else if (type === 'jpg') {
                                this.exportToJPG(source, content);
                            }
                        }
                    });
                }

                async exportToPDF(source, content) {
                    try {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        
                        // Set up document
                        doc.setFontSize(20);
                        doc.setTextColor(37, 99, 235); // Primary blue
                        
                        // Title based on source
                        const titles = {
                            mortgage: 'Mortgage Calculator Report',
                            investment: 'Investment Property Analysis',
                            cashflow: 'Rental Cash Flow Analysis',
                            closing: 'Closing Costs Breakdown',
                            buyer: 'Buyer Cost Sheet',
                            commission: 'Real Estate Commission Analysis',
                            comparison: 'Property Comparison Report',
                            report: 'Complete Property Analysis'
                        };
                        
                        doc.text(titles[source] || 'Property Report', 20, 20);
                        
                        // Add generated date
                        doc.setFontSize(10);
                        doc.setTextColor(107, 114, 128);
                        doc.text(`Generated on ${new Date().toLocaleDateString()}`, 20, 30);
                        

                        
                        let yPos = 50;
                        
                        if (content === 'summary' || content === 'full') {
                            yPos = await this.addCalculatorData(doc, source, yPos, content === 'full');
                        }
                        
                        if (content === 'current' || content === 'full') {
                            // Add chart if available
                            await this.addChartToPDF(doc, source, yPos);
                        }
                        
                        // Add footer
                        const pageHeight = doc.internal.pageSize.height;
                        doc.setFontSize(8);
                        doc.setTextColor(156, 163, 175);
                        doc.text('Generated by HouseMath.app - Professional Real Estate Calculator Suite', 20, pageHeight - 10);
                        
                        // Save the PDF
                        const filename = `${source}-report-${new Date().toISOString().split('T')[0]}.pdf`;
                        doc.save(filename);
                        
                    } catch (error) {
                        console.error('PDF Export Error:', error);
                        alert('PDF export failed. Please ensure you have a modern browser.');
                    }
                }

                async exportToJPG(source, content) {
                    try {
                        // Create a clean export canvas
                        const exportContainer = this.createExportContainer(source, content);
                        document.body.appendChild(exportContainer);
                        
                        // Use html2canvas to capture the container
                        const canvas = await html2canvas(exportContainer, {
                            backgroundColor: '#ffffff',
                            scale: 2, // Higher quality
                            useCORS: true,
                            scrollX: 0,
                            scrollY: 0
                        });
                        
                        // Remove the temporary container
                        document.body.removeChild(exportContainer);
                        
                        // Convert to image and download
                        const link = document.createElement('a');
                        link.download = `${source}-report-${new Date().toISOString().split('T')[0]}.jpg`;
                        link.href = canvas.toDataURL('image/jpeg', 0.95);
                        link.click();
                        
                    } catch (error) {
                        console.error('JPG Export Error:', error);
                        alert('Image export failed. Please ensure you have a modern browser.');
                    }
                }

                createExportContainer(source, content) {
                    const container = document.createElement('div');
                    container.style.cssText = `
                        position: absolute;
                        top: -9999px;
                        left: -9999px;
                        width: 800px;
                        background: white;
                        padding: 40px;
                        font-family: 'Poppins', sans-serif;
                        color: #1f2937;
                        box-sizing: border-box;
                    `;
                    
                    // Title section
                    const titles = {
                        mortgage: 'Mortgage Calculator Report',
                        investment: 'Investment Property Analysis',
                        cashflow: 'Rental Cash Flow Analysis',
                        closing: 'Closing Costs Breakdown',
                        buyer: 'Buyer Cost Sheet',
                        report: 'Complete Property Analysis'
                    };
                    
                    container.innerHTML = `
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h1 style="color: #2563eb; font-size: 28px; margin: 0 0 10px 0;">${titles[source] || 'Property Report'}</h1>
                            <p style="color: #6b7280; margin: 0; font-size: 14px;">Generated on ${new Date().toLocaleDateString()}</p>
                            ${this.getCompanyBranding()}
                        </div>
                        <div id="export-content"></div>
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                            <p style="color: #9ca3af; font-size: 12px; margin: 0;">Generated by HouseMath.app - Professional Real Estate Calculator Suite</p>
                        </div>
                    `;
                    
                    // Add calculator-specific content
                    const exportContent = container.querySelector('#export-content');
                    this.addCalculatorContentToExport(exportContent, source, content);
                    
                    return container;
                }

                getCompanyBranding() {
                    return '';
                }

                addCalculatorContentToExport(container, source, content) {
                    const sourceElement = document.getElementById(`${source}-calculator`);
                    if (!sourceElement) return;
                    
                    // Extract key data from the calculator
                    const statsGrid = sourceElement.querySelector('.stats-grid');
                    const detailsTable = sourceElement.querySelector('.details-table');
                    
                    if (statsGrid) {
                        const statsClone = statsGrid.cloneNode(true);
                        statsClone.style.cssText = `
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 20px;
                            margin-bottom: 30px;
                        `;
                        
                        // Style stat boxes for export
                        const statBoxes = statsClone.querySelectorAll('.stat-box');
                        statBoxes.forEach(box => {
                            box.style.cssText = `
                                background: #f8fafc;
                                border: 1px solid #e2e8f0;
                                border-radius: 8px;
                                padding: 20px;
                                text-align: center;
                            `;
                            
                            const label = box.querySelector('.stat-label');
                            const value = box.querySelector('.stat-value');
                            
                            if (label) {
                                label.style.cssText = `
                                    font-size: 14px;
                                    color: #64748b;
                                    margin-bottom: 8px;
                                `;
                            }
                            
                            if (value) {
                                value.style.cssText = `
                                    font-size: 24px;
                                    font-weight: 600;
                                    color: #2563eb;
                                `;
                            }
                        });
                        
                        container.appendChild(statsClone);
                    }
                    
                    if (detailsTable && content !== 'summary') {
                        const tableClone = detailsTable.cloneNode(true);
                        tableClone.style.cssText = `
                            background: white;
                            border: 1px solid #e5e7eb;
                            border-radius: 8px;
                            overflow: hidden;
                            margin-top: 20px;
                        `;
                        
                        // Style table rows
                        const rows = tableClone.querySelectorAll('.details-row');
                        rows.forEach((row, index) => {
                            row.style.cssText = `
                                display: flex;
                                justify-content: space-between;
                                padding: 12px 20px;
                                border-bottom: ${index < rows.length - 1 ? '1px solid #f3f4f6' : 'none'};
                                background: ${index % 2 === 0 ? '#f9fafb' : 'white'};
                            `;
                            
                            const label = row.querySelector('.details-label');
                            const value = row.querySelector('.details-value');
                            
                            if (label) {
                                label.style.cssText = `
                                    font-weight: 500;
                                    color: #374151;
                                `;
                            }
                            
                            if (value) {
                                value.style.cssText = `
                                    font-weight: 600;
                                    color: #2563eb;
                                `;
                            }
                        });
                        
                        container.appendChild(tableClone);
                    }
                }

                async addCalculatorData(doc, source, yPos, includeDetails) {
                    doc.setFontSize(14);
                    doc.setTextColor(31, 41, 55);
                    
                    const sourceElement = document.getElementById(`${source}-calculator`);
                    if (!sourceElement) return yPos;
                    
                    // Extract key statistics
                    const statBoxes = sourceElement.querySelectorAll('.stat-box');
                    if (statBoxes.length > 0) {
                        doc.setFontSize(16);
                        doc.setTextColor(37, 99, 235);
                        doc.text('Key Results', 20, yPos);
                        yPos += 15;
                        
                        statBoxes.forEach(box => {
                            const label = box.querySelector('.stat-label')?.textContent || '';
                            const value = box.querySelector('.stat-value')?.textContent || '';
                            
                            doc.setFontSize(12);
                            doc.setTextColor(75, 85, 99);
                            doc.text(label, 25, yPos);
                            doc.setTextColor(37, 99, 235);
                            doc.text(value, 120, yPos);
                            yPos += 10;
                        });
                        
                        yPos += 10;
                    }
                    
                    if (includeDetails) {
                        // Add detailed breakdown
                        const detailsTable = sourceElement.querySelector('.details-table');
                        if (detailsTable) {
                            doc.setFontSize(16);
                            doc.setTextColor(37, 99, 235);
                            doc.text('Detailed Breakdown', 20, yPos);
                            yPos += 15;
                            
                            const rows = detailsTable.querySelectorAll('.details-row');
                            rows.forEach(row => {
                                const label = row.querySelector('.details-label')?.textContent || '';
                                const value = row.querySelector('.details-value')?.textContent || '';
                                
                                doc.setFontSize(10);
                                doc.setTextColor(75, 85, 99);
                                doc.text(label, 25, yPos);
                                doc.setTextColor(37, 99, 235);
                                doc.text(value, 120, yPos);
                                yPos += 8;
                            });
                        }
                    }
                    
                    return yPos + 20;
                }

                async addChartToPDF(doc, source, yPos) {
                    try {
                        const chartCanvas = document.querySelector(`#${source}-calculator canvas`);
                        if (!chartCanvas) return;
                        
                        const chartImage = chartCanvas.toDataURL('image/png');
                        doc.addImage(chartImage, 'PNG', 20, yPos, 160, 80);
                    } catch (error) {
                        // Chart export failed - continue without chart
                    }
                }
            }

            // Initialize the export manager
            const exportManager = new ExportManager();

            // Enhanced Mobile Menu Handler
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const mobileMenuClose = document.getElementById('mobile-menu-close');
            const mobileTabs = document.querySelectorAll('.mobile-tab');

            // Check if mobile menu elements exist before adding listeners
            if (!mobileMenuToggle || !mobileMenuOverlay || !mobileMenuClose) {
                return; // Mobile menu not available
            }

            // Open mobile menu
            mobileMenuToggle.addEventListener('click', () => {
                mobileMenuOverlay.classList.add('show');
                hapticFeedback('light');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            });

            // Close mobile menu
            function closeMobileMenu() {
                mobileMenuOverlay.classList.remove('show');
                document.body.style.overflow = '';
            }

            mobileMenuClose.addEventListener('click', closeMobileMenu);

            // Close when clicking overlay background
            mobileMenuOverlay.addEventListener('click', (e) => {
                if (e.target === mobileMenuOverlay) {
                    closeMobileMenu();
                }
            });

            // Handle mobile tab selection
            mobileTabs.forEach(mobileTab => {
                mobileTab.addEventListener('click', () => {
                    // Remove active class from all mobile tabs
                    mobileTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    mobileTab.classList.add('active');
                    
                    // Also update desktop tabs if visible
                    const tabId = mobileTab.getAttribute('data-tab');
                    const desktopTabs = document.querySelectorAll('.tab');
                    desktopTabs.forEach(t => t.classList.remove('active'));
                    const matchingDesktopTab = document.querySelector(`.tab[data-tab="${tabId}"]`);
                    if (matchingDesktopTab) {
                        matchingDesktopTab.classList.add('active');
                    }
                    
                    // Hide all calculators and show selected one
                    const calculators = ['mortgage', 'investment', 'cashflow', 'closing', 'buyer', 'commission', 'comparison', 'report'];
                    calculators.forEach(calc => {
                        const element = document.getElementById(`${calc}-calculator`);
                        if (element) element.classList.add('hidden');
                    });
                    
                    const selectedCalculator = document.getElementById(`${tabId}-calculator`);
                    if (selectedCalculator) {
                        selectedCalculator.classList.remove('hidden');
                    }
                    
                    hapticFeedback('medium');
                    closeMobileMenu();
                    
                    // Scroll to top of content
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });

            // Close menu with escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && mobileMenuOverlay.classList.contains('show')) {
                    closeMobileMenu();
                }
            });

            // Initialize mobile enhancements
            setupInputValidation();
            setupAutoSave();
            
            // Load any auto-saved data
            setTimeout(() => {
                loadAutoSavedData();
            }, 1000);

            // Set visited flag for first-time users
            setTimeout(() => {
                if (!localStorage.getItem('hasVisited')) {
                    try {
                        localStorage.setItem('hasVisited', 'true');
                    } catch (e) {
                        // localStorage not available
                    }
                }
            }, 2000);
        });

        // Hide loading screen after page loads
        window.addEventListener('load', function() {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 1500); // Show loading for at least 1.5 seconds
        });

        // Production readiness check
        function performProductionChecks() {
            // Check if all required elements exist
            const requiredElements = [
                'app-title', 'mobile-menu-toggle', 'mobile-menu-overlay', 'mobile-menu-close',
                'mortgage-calculator', 'investment-calculator', 'cashflow-calculator',
                'closing-calculator', 'buyer-calculator', 'commission-calculator',
                'comparison-calculator'
            ];
            
            let allElementsExist = true;
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    allElementsExist = false;
                }
            });
            
            // Check if Chart.js is loaded
            const chartsAvailable = typeof Chart !== 'undefined';
            
            // Check if export libraries are loaded
            const exportAvailable = typeof window.jspdf !== 'undefined' && typeof html2canvas !== 'undefined';
            
            // All checks passed - app is production ready
            return allElementsExist && chartsAvailable;
        }
        
        // Run production checks after page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                const isReady = performProductionChecks();
                if (isReady) {
                    document.body.classList.add('production-ready');
                }
            }, 100);
        });
    </script>
    
    <!-- SEO Footer -->
    <footer role="contentinfo" style="background: var(--card-bg); border-top: 1px solid var(--border-color); margin-top: 50px; padding: 40px 20px 20px;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 30px;">
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 15px; font-size: 1.125rem;">Real Estate Calculators</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 8px;"><a href="#mortgage" onclick="document.querySelector('.tab[data-tab=&quot;mortgage&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Mortgage Payment Calculator</a></li>
                        <li style="margin-bottom: 8px;"><a href="#investment" onclick="document.querySelector('.tab[data-tab=&quot;investment&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Investment Property Analysis</a></li>
                        <li style="margin-bottom: 8px;"><a href="#cashflow" onclick="document.querySelector('.tab[data-tab=&quot;cashflow&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Rental Cash Flow Calculator</a></li>
                        <li style="margin-bottom: 8px;"><a href="#closing" onclick="document.querySelector('.tab[data-tab=&quot;closing&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Closing Costs Calculator</a></li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 15px; font-size: 1.125rem;">Professional Tools</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 8px;"><a href="#buyer" onclick="document.querySelector('.tab[data-tab=&quot;buyer&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Buyer Cost Sheet</a></li>
                        <li style="margin-bottom: 8px;"><a href="#commission" onclick="document.querySelector('.tab[data-tab=&quot;commission&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Commission Calculator</a></li>
                        <li style="margin-bottom: 8px;"><a href="#comparison" onclick="document.querySelector('.tab[data-tab=&quot;comparison&quot;]')?.click()" style="color: var(--text-color); text-decoration: none; opacity: 0.8; font-size: 0.875rem; cursor: pointer;">Property Comparison Tool</a></li>
                        <li style="margin-bottom: 8px;"><span style="color: var(--text-color); opacity: 0.8; font-size: 0.875rem;">PDF & JPG Export</span></li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 15px; font-size: 1.125rem;">Features</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin-bottom: 8px;"><span style="color: var(--text-color); opacity: 0.8; font-size: 0.875rem;">‚úì Free to Use</span></li>
                        <li style="margin-bottom: 8px;"><span style="color: var(--text-color); opacity: 0.8; font-size: 0.875rem;">‚úì Mobile Responsive</span></li>
                        <li style="margin-bottom: 8px;"><span style="color: var(--text-color); opacity: 0.8; font-size: 0.875rem;">‚úì Professional Reports</span></li>
                        <li style="margin-bottom: 8px;"><span style="color: var(--text-color); opacity: 0.8; font-size: 0.875rem;">‚úì Real-time Calculations</span></li>
                    </ul>
                </div>
            </div>
            
            <div style="border-top: 1px solid var(--border-color); padding-top: 20px; text-align: center;">
                <p style="margin: 0 0 10px 0; color: var(--text-color); opacity: 0.8; font-size: 0.875rem;">
                    ¬© 2024 HouseMath.app - Professional Real Estate Calculator Suite | Free Tools for Real Estate Professionals
                </p>
                <p style="margin: 0; color: var(--text-color); opacity: 0.6; font-size: 0.75rem;">
                    Mortgage calculators, investment analysis, cash flow calculations, closing costs, and commission tools for real estate agents, investors, and home buyers.
                </p>
            </div>
        </div>
    </footer>
    </main>
</body>
</html>